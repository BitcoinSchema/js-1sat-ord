!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("bsv-wasm"),require("buffer"),require("dotenv"),require("sigma-protocol")):"function"==typeof define&&define.amd?define(["exports","bsv-wasm","buffer","dotenv","sigma-protocol"],r):r((t||self).js1SatOrd={},t.bsvWasm,t.buffer,t.dotenv,t.sigmaProtocol)}(this,function(t,r,e,n,i){function o(t){if(t&&t.__esModule)return t;var r=Object.create(null);return t&&Object.keys(t).forEach(function(e){if("default"!==e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}}),r.default=t,r}function s(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function a(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return s(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u=function(t){for(var r=[],e=0,n=t.length;e<n;e++){var i=Number(t.charCodeAt(e)).toString(16);r.push(i)}return r.join("")};/*#__PURE__*/o(n).config();var c=function(t,n,i,o){var s="";if(void 0!==n&&void 0!==i){var a=u("ord"),c=e.Buffer.from(n,"base64").toString("hex");s="OP_0 OP_IF "+a+" OP_1 "+u(i)+" OP_0 "+c+" OP_ENDIF"}var f=t.get_locking_script().to_asm_string()+(s?" "+s:"");if(o&&null!=o&&o.app&&null!=o&&o.type){f=f+" OP_RETURN "+u("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+u("SET");for(var _=0,d=Object.entries(o);_<d.length;_++){var g=d[_],l=g[0],p=g[1];"cmd"!==l&&(f=f+" "+u(l)+" "+u(p))}}return r.Script.from_asm_string(f)};t.buildInscription=c,t.createOrdinal=function(t,n,o,s,a,u,f,_){try{var d=function(e){var n=g.sign(o,r.SigHash.ALL|r.SigHash.FORKID,0,r.Script.from_asm_string(t.script),BigInt(t.satoshis));return l.set_unlocking_script(r.Script.from_asm_string(n.to_hex()+" "+o.to_public_key().to_hex())),g.set_input(0,l),g},g=new r.Transaction(1,0),l=new r.TxIn(e.Buffer.from(t.txid,"hex"),t.vout,r.Script.from_asm_string(""));g.add_input(l);var p=c(r.P2PKHAddress.from_string(n),u.dataB64,u.contentType,f),m=new r.TxOut(BigInt(1),p);g.add_output(m);var v=r.P2PKHAddress.from_string(s).get_locking_script(),h=new r.TxOut(BigInt(1),v),y=Math.ceil(a*(g.get_size()+h.to_bytes().byteLength)),x=t.satoshis-1-y;if(x<0)throw new Error("Inadequate satoshis for fee");if(x>0){var b=new r.TxOut(BigInt(x),v);g.add_output(b)}var S=null==_?void 0:_.idKey,O=null==_?void 0:_.keyHost,I=function(){if(!S)return function(){if(O){var t=null==_?void 0:_.authToken,r=new i.Sigma(g);return function(e,n){try{var i=Promise.resolve(r.remoteSign(O,t)).then(function(t){g=t.signedTx})}catch(t){return n(t)}return i&&i.then?i.then(void 0,n):i}(0,function(t){throw console.log(t),new Error("Remote signing to "+O+" failed")})}}();var t=new i.Sigma(g).sign(S);g=t.signedTx}();return Promise.resolve(I&&I.then?I.then(d):d())}catch(t){return Promise.reject(t)}},t.reinscribeOrdinalTemplate=function(t,n,i,o){try{var s=new r.Transaction(1,0),a=new r.TxIn(e.Buffer.from(t.txid,"hex"),t.vout,r.Script.from_asm_string(t.script));s.add_input(a);var u=c(r.P2PKHAddress.from_string(n),null==i?void 0:i.dataB64,null==i?void 0:i.contentType,o),f=new r.TxOut(BigInt(1),u);return s.add_output(f),Promise.resolve(s)}catch(t){return Promise.reject(t)}},t.sendOrdinal=function(t,n,i,o,s,a,u,f,_){try{var d=new r.Transaction(1,0),g=new r.TxIn(e.Buffer.from(n.txid,"hex"),n.vout,r.Script.from_asm_string(""));d.add_input(g);var l,p=new r.TxIn(e.Buffer.from(t.txid,"hex"),t.vout,r.Script.from_asm_string(""));d.add_input(p);var m=r.P2PKHAddress.from_string(u);l=null!=f&&f.dataB64&&null!=f&&f.contentType?c(m,f.dataB64,f.contentType,_):m.get_locking_script();var v=new r.TxOut(BigInt(1),l);d.add_output(v);var h=r.P2PKHAddress.from_string(o).get_locking_script(),y=new r.TxOut(BigInt(1),h),x=Math.ceil(s*(d.get_size()+y.to_bytes().byteLength)),b=new r.TxOut(BigInt(t.satoshis-x),h);d.add_output(b);var S=d.sign(a,r.SigHash.InputOutput,0,r.Script.from_asm_string(n.script),BigInt(n.satoshis));g.set_unlocking_script(r.Script.from_asm_string(S.to_hex()+" "+a.to_public_key().to_hex())),d.set_input(0,g);var O=d.sign(i,r.SigHash.InputOutput,1,r.Script.from_asm_string(t.script),BigInt(t.satoshis));return p.set_unlocking_script(r.Script.from_asm_string(O.to_hex()+" "+i.to_public_key().to_hex())),d.set_input(1,p),Promise.resolve(d)}catch(t){return Promise.reject(t)}},t.sendUtxos=function(t,n,i,o){try{for(var s,u=new r.Transaction(1,0),c=0,f=a(t||[]);!(s=f()).done;)c+=s.value.satoshis;var _=c-o;console.log({feeSats:o,satsIn:c,satsOut:_}),u.add_output(new r.TxOut(BigInt(_),i.get_locking_script()));for(var d,g=0,l=a(t||[]);!(d=l()).done;){var p=d.value;console.log({u:p});var m=new r.TxIn(e.Buffer.from(p.txid,"hex"),p.vout,r.Script.from_asm_string(""));console.log({inx:m}),m.set_satoshis(BigInt(p.satoshis)),u.add_input(m);var v=u.sign(n,r.SigHash.InputOutputs,g,r.Script.from_asm_string(p.script),BigInt(p.satoshis));m.set_unlocking_script(r.Script.from_asm_string(v.to_hex()+" "+n.to_public_key().to_hex())),u.set_input(g,m),g++}return Promise.resolve(u)}catch(t){return Promise.reject(t)}}});
//# sourceMappingURL=index.umd.js.map
