!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("bsv-wasm"),require("buffer"),require("fs"),require("path"),require("os"),require("sigma-protocol")):"function"==typeof define&&define.amd?define(["exports","bsv-wasm","buffer","fs","path","os","sigma-protocol"],e):e((t||self).js1SatOrd={},t.bsvWasm,t.buffer,t.fs,t.path,t.os,t.sigmaProtocol)}(this,function(t,e,r,n,o,i,s){function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var u=/*#__PURE__*/a(n),c=/*#__PURE__*/a(o),f=/*#__PURE__*/a(i);function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const p=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function g(t){console.log(`[dotenv@16.0.3][DEBUG] ${t}`)}const _={config:function(t){let e=c.default.resolve(process.cwd(),".env"),r="utf8";const n=Boolean(t&&t.debug),o=Boolean(t&&t.override);var i;t&&(null!=t.path&&(e="~"===(i=t.path)[0]?c.default.join(f.default.homedir(),i.slice(1)):i),null!=t.encoding&&(r=t.encoding));try{const t=_.parse(u.default.readFileSync(e,{encoding:r}));return Object.keys(t).forEach(function(e){Object.prototype.hasOwnProperty.call(process.env,e)?(!0===o&&(process.env[e]=t[e]),n&&g(!0===o?`"${e}" is already defined in \`process.env\` and WAS overwritten`:`"${e}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[e]=t[e]}),{parsed:t}}catch(t){return n&&g(`Failed to load ${e} ${t.message}`),{error:t}}},parse:function(t){const e={};let r,n=t.toString();for(n=n.replace(/\r\n?/gm,"\n");null!=(r=p.exec(n));){const t=r[1];let n=r[2]||"";n=n.trim();const o=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(n=n.replace(/\\n/g,"\n"),n=n.replace(/\\r/g,"\r")),e[t]=n}return e}};var m=_.config,v=_.parse,h=_;h.config=m,h.parse=v;var y=function(t){for(var e=[],r=0,n=t.length;r<n;r++){var o=Number(t.charCodeAt(r)).toString(16);e.push(o)}return e.join("")};m();var x=function(t,n,o,i){var s="";if(void 0!==n&&void 0!==o){var a=y("ord"),u=r.Buffer.from(n,"base64").toString("hex");s="OP_0 OP_IF "+a+" OP_1 "+y(o)+" OP_0 "+u+" OP_ENDIF"}var c=t.get_locking_script().to_asm_string()+(s?" "+s:"");if(i&&null!=i&&i.app&&null!=i&&i.type){c=c+" OP_RETURN "+y("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+y("SET");for(var f=0,l=Object.entries(i);f<l.length;f++){var d=l[f],p=d[0],g=d[1];"cmd"!==p&&(c=c+" "+y(p)+" "+y(g))}}return e.Script.from_asm_string(c)};t.buildInscription=x,t.buildReinscriptionTemplate=function(t,n,o,i){try{var s=new e.Transaction(1,0),a=new e.TxIn(r.Buffer.from(t.txid,"hex"),t.vout,e.Script.from_asm_string(t.script));s.add_input(a);var u=x(e.P2PKHAddress.from_string(n),null==o?void 0:o.dataB64,null==o?void 0:o.contentType,i),c=new e.TxOut(BigInt(1),u);return s.add_output(c),Promise.resolve(s)}catch(t){return Promise.reject(t)}},t.createOrdinal=function(t,n,o,i,a,u,c,f){try{var l=function(r){var n=d.sign(o,e.SigHash.ALL|e.SigHash.FORKID,0,e.Script.from_asm_string(t.script),BigInt(t.satoshis));return p.set_unlocking_script(e.Script.from_asm_string(n.to_hex()+" "+o.to_public_key().to_hex())),d.set_input(0,p),d},d=new e.Transaction(1,0),p=new e.TxIn(r.Buffer.from(t.txid,"hex"),t.vout,e.Script.from_asm_string(""));d.add_input(p);var g=x(e.P2PKHAddress.from_string(n),u.dataB64,u.contentType,c),_=new e.TxOut(BigInt(1),g);d.add_output(_);var m=e.P2PKHAddress.from_string(i).get_locking_script(),v=new e.TxOut(BigInt(1),m),h=Math.ceil(a*(d.get_size()+v.to_bytes().byteLength)),y=t.satoshis-1-h;if(y<0)throw new Error("Inadequate satoshis for fee");if(y>0){var b=new e.TxOut(BigInt(y),m);d.add_output(b)}var S=null==f?void 0:f.idKey,w=null==f?void 0:f.keyHost,T=function(){if(!S)return function(){if(w){var t=null==f?void 0:f.authToken,e=new s.Sigma(d);return function(r,n){try{var o=Promise.resolve(e.remoteSign(w,t)).then(function(t){d=t.signedTx})}catch(t){return n(t)}return o&&o.then?o.then(void 0,n):o}(0,function(t){throw console.log(t),new Error("Remote signing to "+w+" failed")})}}();var t=new s.Sigma(d).sign(S);d=t.signedTx}();return Promise.resolve(T&&T.then?T.then(l):l())}catch(t){return Promise.reject(t)}},t.sendOrdinal=function(t,n,o,i,s,a,u,c,f){try{var l=new e.Transaction(1,0),d=new e.TxIn(r.Buffer.from(n.txid,"hex"),n.vout,e.Script.from_asm_string(""));l.add_input(d);var p,g=new e.TxIn(r.Buffer.from(t.txid,"hex"),t.vout,e.Script.from_asm_string(""));l.add_input(g);var _=e.P2PKHAddress.from_string(u);p=null!=c&&c.dataB64&&null!=c&&c.contentType?x(_,c.dataB64,c.contentType,f):_.get_locking_script();var m=new e.TxOut(BigInt(1),p);l.add_output(m);var v=e.P2PKHAddress.from_string(i).get_locking_script(),h=new e.TxOut(BigInt(1),v),y=Math.ceil(s*(l.get_size()+h.to_bytes().byteLength)),b=new e.TxOut(BigInt(t.satoshis-y),v);l.add_output(b);var S=l.sign(a,e.SigHash.InputOutput,0,e.Script.from_asm_string(n.script),BigInt(n.satoshis));d.set_unlocking_script(e.Script.from_asm_string(S.to_hex()+" "+a.to_public_key().to_hex())),l.set_input(0,d);var w=l.sign(o,e.SigHash.InputOutput,1,e.Script.from_asm_string(t.script),BigInt(t.satoshis));return g.set_unlocking_script(e.Script.from_asm_string(w.to_hex()+" "+o.to_public_key().to_hex())),l.set_input(1,g),Promise.resolve(l)}catch(t){return Promise.reject(t)}},t.sendUtxos=function(t,n,o,i){try{for(var s,a=new e.Transaction(1,0),u=0,c=d(t||[]);!(s=c()).done;)u+=s.value.satoshis;var f=u-i;console.log({feeSats:i,satsIn:u,satsOut:f}),a.add_output(new e.TxOut(BigInt(f),o.get_locking_script()));for(var l,p=0,g=d(t||[]);!(l=g()).done;){var _=l.value;console.log({u:_});var m=new e.TxIn(r.Buffer.from(_.txid,"hex"),_.vout,e.Script.from_asm_string(""));console.log({inx:m}),m.set_satoshis(BigInt(_.satoshis)),a.add_input(m);var v=a.sign(n,e.SigHash.InputOutputs,p,e.Script.from_asm_string(_.script),BigInt(_.satoshis));m.set_unlocking_script(e.Script.from_asm_string(v.to_hex()+" "+n.to_public_key().to_hex())),a.set_input(p,m),p++}return Promise.resolve(a)}catch(t){return Promise.reject(t)}}});
//# sourceMappingURL=index.umd.js.map
