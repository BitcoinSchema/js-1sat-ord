!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@bsv/sdk"),require("sigma-protocol")):"function"==typeof define&&define.amd?define(["exports","@bsv/sdk","sigma-protocol"],t):t((r||self).js1SatOrd={},r.bsv,r.sigmaProtocol)}(this,function(r,t,n){function e(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=Array(t);n<t;n++)e[n]=r[n];return e}function o(r,t){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(n)return(n=n.call(r)).next.bind(n);if(Array.isArray(r)||(n=function(r,t){if(r){if("string"==typeof r)return e(r,t);var n={}.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){n&&(r=n);var o=0;return function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(){return i=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)({}).hasOwnProperty.call(n,e)&&(r[e]=n[e])}return r},i.apply(null,arguments)}function a(r,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,t){return r.__proto__=t,r},a(r,t)}var s,u=function(r){return Buffer.from(r).toString("hex")},c=/*#__PURE__*/function(r){function n(){return r.apply(this,arguments)||this}var e,o;return o=r,(e=n).prototype=Object.create(o.prototype),e.prototype.constructor=e,a(e,o),n.prototype.lock=function(r,n,e,o){var i="";if(void 0!==n&&void 0!==e){var a=u("ord"),s=Buffer.from(n,"base64").toString("hex").trim();if(!s)throw new Error("Invalid file data");var c=u(e);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+a+" OP_1 "+c+" OP_0 "+s+" OP_ENDIF"}var d=(i?i+" ":"")+(new t.P2PKH).lock(r).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){d=d+" OP_RETURN "+u("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+u("SET");for(var l=0,f=Object.entries(o);l<f.length;l++){var v=f[l],p=v[0],h=v[1];"cmd"!==p&&(d=d+" "+u(p)+" "+u(h))}}return t.LockingScript.fromASM(d)},n}(t.P2PKH),d=function(r,n){var e=t.fromUtxo(i({},r,{script:Buffer.from(r.script,"base64").toString("hex")}),n);return e.sourceTXID=r.txid,e},l=function(r,t){try{var e,o=function(r){if(e)return r;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==t?void 0:t.idKey,a=null==t?void 0:t.keyHost;if(i){var s=new n.Sigma(r).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==t?void 0:t.authToken,i=new n.Sigma(r);return function(r,t){try{var n=Promise.resolve(i.remoteSign(a,o)).then(function(r){return e=1,r.signedTx})}catch(r){return t(r)}return n&&n.then?n.then(void 0,t):n}(0,function(r){throw console.log(r),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(r){return Promise.reject(r)}},f=function(r,n,e,i,a,s,u,f,v,p,h){void 0===u&&(u=10),void 0===p&&(p=[]),void 0===h&&(h=!0);try{for(var m,g=function(){return Promise.resolve(y.fee(P)).then(function(){return Promise.resolve(y.sign()).then(function(){return y})})},P=new t.SatoshisPerKilobyte(u),y=new t.Transaction,w=o(n);!(m=w()).done;){var S=m.value;if(1!==S.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var b=d(S,(new c).unlock(i));y.addInput(b)}for(var k,O=o(r);!(k=O()).done;){var K=d(k.value,(new t.P2PKH).unlock(e));y.addInput(K)}if(h&&a.length!==n.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var I,T=o(a);!(I=T()).done;){var A,j,E,x=I.value;E=null!=(A=x.inscription)&&A.dataB64&&null!=(j=x.inscription)&&j.contentType?(new c).lock(x.address,x.inscription.dataB64,x.inscription.contentType,f):(new t.P2PKH).lock(x.address),y.addOutput({satoshis:1,lockingScript:E})}for(var B,H=o(p);!(B=H()).done;){var _=B.value;console.log("Additional payment",_),y.addOutput({satoshis:_.amount,lockingScript:(new t.P2PKH).lock(_.to)})}var M=(new t.P2PKH).lock(s||e.toAddress().toString());y.addOutput({lockingScript:M,change:!0});var U=function(){if(v)return Promise.resolve(l(y,v)).then(function(r){y=r})}();return Promise.resolve(U&&U.then?U.then(g):g())}catch(r){return Promise.reject(r)}};!function(r){r.BSV20="bsv20",r.BSV21="bsv21"}(s||(s={})),r.createOrdinals=function(r,n,e,i,a,s,u,f){void 0===a&&(a=10),void 0===f&&(f=[]);try{for(var v,p=function(){return Promise.resolve(m.fee(h)).then(function(){return Promise.resolve(m.sign()).then(function(){return m})})},h=new t.SatoshisPerKilobyte(a),m=new t.Transaction,g=o(r);!(v=g()).done;){var P=d(v.value,(new t.P2PKH).unlock(e));m.addInput(P)}n.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var y,w=o(n);!(y=w()).done;){var S=y.value;if(!S.inscription)throw new Error("Inscription is required for all destinations");m.addOutput({satoshis:1,lockingScript:(new c).lock(S.address,S.inscription.dataB64,S.inscription.contentType,s)})}for(var b,k=o(f);!(b=k()).done;){var O=b.value;m.addOutput({satoshis:O.amount,lockingScript:(new t.P2PKH).lock(O.to)})}m.addOutput({lockingScript:(new t.P2PKH).lock(i||e.toAddress().toString()),change:!0});var K=function(){if(u)return Promise.resolve(l(m,u)).then(function(r){m=r})}();return Promise.resolve(K&&K.then?K.then(p):p())}catch(r){return Promise.reject(r)}},r.sendOrdinals=f,r.sendUtxos=function(r,n,e,i){void 0===i&&(i=10);try{for(var a,s=new t.SatoshisPerKilobyte(i),u=new t.Transaction,c=o(r);!(a=c()).done;){var l=d(a.value,(new t.P2PKH).unlock(n));u.addInput(l)}for(var f,v=o(e);!(f=v()).done;){var p=f.value,h={satoshis:p.amount,lockingScript:(new t.P2PKH).lock(p.to)};u.addOutput(h)}var m=n.toAddress().toString(),g=(new t.P2PKH).lock(m);return u.addOutput({lockingScript:g,change:!0}),Promise.resolve(u.fee(s)).then(function(){return Promise.resolve(u.sign()).then(function(){return u})})}catch(r){return Promise.reject(r)}},r.transferOrdTokens=function(r,t,n,e,a,u,c,d,l,v,p,h,m){void 0===v&&(v=10),void 0===m&&(m=[]);try{var g=0n,P=0n,y=0n;if(!e.every(function(r){return r.id===t}))throw new Error("Input tokens do not match the provided tokenID");for(var w,S=o(e);!(w=S()).done;)P+=BigInt(w.value.amt);for(var b,k=o(a);!(b=k()).done;)y+=BigInt(b.value.amt);if(P<y)throw new Error("Not enough tokens to send");if((g=P-y)>0n){var O={address:l||c.toAddress().toString(),amt:g.toString()};a.push(O)}var K=a.map(function(n){var e,o={p:"bsv-20",op:"transfer",amt:n.amt};if(r===s.BSV20)e=i({},o,{tick:t});else{if(r!==s.BSV21)throw new Error("Invalid protocol");e=i({},o,{id:t})}return{address:n.address,inscription:{dataB64:Buffer.from(JSON.stringify(e)).toString("base64"),contentType:"application/bsv-20"}}});return Promise.resolve(f(n,e,u,c,K,d||u.toAddress().toString(),v,p,h,m,!1))}catch(r){return Promise.reject(r)}}});
//# sourceMappingURL=index.umd.js.map
