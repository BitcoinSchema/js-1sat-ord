!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@bsv/sdk"),require("sigma-protocol")):"function"==typeof define&&define.amd?define(["exports","@bsv/sdk","sigma-protocol"],t):t((n||self).js1SatOrd={},n.bsv,n.sigmaProtocol)}(this,function(n,t,r){function e(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=Array(t);r<t;r++)e[r]=n[r];return e}function o(n,t){var r="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(r)return(r=r.call(n)).next.bind(r);if(Array.isArray(n)||(r=function(n,t){if(n){if("string"==typeof n)return e(n,t);var r={}.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}(n))||t&&n&&"number"==typeof n.length){r&&(n=r);var o=0;return function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(){return i=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)({}).hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n},i.apply(null,arguments)}function a(n,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},a(n,t)}var s=function(n){return Buffer.from(n).toString("hex")},u=/*#__PURE__*/function(n){function r(){return n.apply(this,arguments)||this}var e,o;return o=n,(e=r).prototype=Object.create(o.prototype),e.prototype.constructor=e,a(e,o),r.prototype.lock=function(n,r,e,o){var i="";if(void 0!==r&&void 0!==e){var a=s("ord"),u=Buffer.from(r,"base64").toString("hex").trim();if(!u)throw new Error("Invalid file data");var c=s(e);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+a+" OP_1 "+c+" OP_0 "+u+" OP_ENDIF"}var f=(i?i+" ":"")+(new t.P2PKH).lock(n).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){f=f+" OP_RETURN "+s("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+s("SET");for(var l=0,d=Object.entries(o);l<d.length;l++){var v=d[l],h=v[0],p=v[1];"cmd"!==h&&(f=f+" "+s(h)+" "+s(p))}}return t.LockingScript.fromASM(f)},r}(t.P2PKH),c=function(n,r){var e=t.fromUtxo(i({},n,{script:Buffer.from(n.script,"base64").toString("hex")}),r);return e.sourceTXID=n.txid,e},f=function(n,t){try{var e,o=function(n){if(e)return n;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==t?void 0:t.idKey,a=null==t?void 0:t.keyHost;if(i){var s=new r.Sigma(n).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==t?void 0:t.authToken,i=new r.Sigma(n);return function(n,t){try{var r=Promise.resolve(i.remoteSign(a,o)).then(function(n){return e=1,n.signedTx})}catch(n){return t(n)}return r&&r.then?r.then(void 0,t):r}(0,function(n){throw console.log(n),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(n){return Promise.reject(n)}},l=function(n,r,e,i,a,s,l,d,v,h,p){void 0===l&&(l=10),void 0===h&&(h=[]),void 0===p&&(p=!0);try{for(var m,g=function(){return Promise.resolve(P.fee(y)).then(function(){return Promise.resolve(P.sign()).then(function(){return P})})},y=new t.SatoshisPerKilobyte(l),P=new t.Transaction,w=o(r);!(m=w()).done;){var b=m.value;if(1!==b.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var S=c(b,(new u).unlock(i));P.addInput(S)}if(p&&a.length!==r.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var k,O=o(a);!(k=O()).done;){var T,I,K,E=k.value;K=null!=(T=E.inscription)&&T.dataB64&&null!=(I=E.inscription)&&I.contentType?(new u).lock(E.address,E.inscription.dataB64,E.inscription.contentType,d):(new t.P2PKH).lock(E.address),P.addOutput({satoshis:1,lockingScript:K})}for(var j,A=o(h);!(j=A()).done;){var x=j.value;console.log("Additional payment",x),P.addOutput({satoshis:x.amount,lockingScript:(new t.P2PKH).lock(x.to)})}for(var B,H=o(n);!(B=H()).done;){var _=c(B.value,(new t.P2PKH).unlock(e));P.addInput(_)}var M=(new t.P2PKH).lock(s||e.toAddress().toString());P.addOutput({lockingScript:M,change:!0});var N=function(){if(v)return Promise.resolve(f(P,v)).then(function(n){P=n})}();return Promise.resolve(N&&N.then?N.then(g):g())}catch(n){return Promise.reject(n)}};const d="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function v(n,t,r){if(!n.s){if(r instanceof p){if(!r.s)return void(r.o=v.bind(null,n,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(v.bind(null,n,t),v.bind(null,n,2));n.s=t,n.v=r;var e=n.o;e&&e(n)}}var h,p=/*#__PURE__*/function(){function n(){}return n.prototype.then=function(t,r){var e=new n,o=this.s;if(o){var i=1&o?t:r;if(i){try{v(e,1,i(this.v))}catch(n){v(e,2,n)}return e}return this}return this.o=function(n){try{var o=n.v;1&n.s?v(e,1,t?t(o):o):r?v(e,1,r(o)):v(e,2,o)}catch(n){v(e,2,n)}},e},n}();function m(n){return n instanceof p&&1&n.s}!function(n){n.BSV20="bsv20",n.BSV21="bsv21"}(h||(h={})),n.createOrdinals=function(n,r,e,i,a,s,l,d){void 0===a&&(a=10),void 0===d&&(d=[]);try{for(var v,h=function(){return Promise.resolve(m.fee(p)).then(function(){return Promise.resolve(m.sign()).then(function(){return m})})},p=new t.SatoshisPerKilobyte(a),m=new t.Transaction,g=o(n);!(v=g()).done;){var y=c(v.value,(new t.P2PKH).unlock(e));m.addInput(y)}r.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var P,w=o(r);!(P=w()).done;){var b=P.value;if(!b.inscription)throw new Error("Inscription is required for all destinations");m.addOutput({satoshis:1,lockingScript:(new u).lock(b.address,b.inscription.dataB64,b.inscription.contentType,s)})}for(var S,k=o(d);!(S=k()).done;){var O=S.value;m.addOutput({satoshis:O.amount,lockingScript:(new t.P2PKH).lock(O.to)})}m.addOutput({lockingScript:(new t.P2PKH).lock(i||e.toAddress().toString()),change:!0});var T=function(){if(l)return Promise.resolve(f(m,l)).then(function(n){m=n})}();return Promise.resolve(T&&T.then?T.then(h):h())}catch(n){return Promise.reject(n)}},n.sendOrdinals=l,n.sendUtxos=function(n,r,e,i){void 0===i&&(i=10);try{for(var a,s,u=function(){if(P<w+b)throw new Error("Not enough funds to deploy token. Total sats in: "+P+", Total sats out: "+w+", Fee: "+b);if(P>w+b){var n=r.toAddress().toString(),e=(new t.P2PKH).lock(n);l.addOutput({lockingScript:e,change:!0})}else P<w+b&&console.log("No change needed");return Promise.resolve(l.fee(f)).then(function(){return Promise.resolve(l.sign()).then(function(){return l})})},f=new t.SatoshisPerKilobyte(i),l=new t.Transaction,h=o(e);!(s=h()).done;){var g=s.value,y={satoshis:g.amount,lockingScript:(new t.P2PKH).lock(g.to)};l.addOutput(y)}var P=0n,w=l.outputs.reduce(function(n,t){return n+(t.satoshis||0)},0),b=0,S=function(n,t,r){if("function"==typeof n[d]){var e,o,i,a=n[d]();if(function n(s){try{for(;!((e=a.next()).done||r&&r());)if((s=t(e.value))&&s.then){if(!m(s))return void s.then(n,i||(i=v.bind(null,o=new p,2)));s=s.v}o?v(o,1,s):o=s}catch(n){v(o||(o=new p),2,n)}}(),a.return){var s=function(n){try{e.done||a.return()}catch(n){}return n};if(o&&o.then)return o.then(s,function(n){throw s(n)});s()}return o}if(!("length"in n))throw new TypeError("Object is not iterable");for(var u=[],c=0;c<n.length;c++)u.push(n[c]);return function(n,t,r){var e,o,i=-1;return function a(s){try{for(;++i<n.length&&(!r||!r());)if((s=t(i))&&s.then){if(!m(s))return void s.then(a,o||(o=v.bind(null,e=new p,2)));s=s.v}e?v(e,1,s):e=s}catch(n){v(e||(e=new p),2,n)}}(),e}(u,function(n){return t(u[n])},r)}(n,function(n){var e=c(n,(new t.P2PKH).unlock(r));return l.addInput(e),P+=BigInt(n.satoshis),Promise.resolve(f.computeFee(l)).then(function(n){P>=w+(b=n)&&(a=1)})},function(){return a});return Promise.resolve(S&&S.then?S.then(u):u())}catch(n){return Promise.reject(n)}},n.transferOrdTokens=function(n,t,r,e,a,s,u,c,f,d,v,p,m){void 0===d&&(d=10),void 0===m&&(m=[]);try{var g=0n,y=0n,P=0n;if(!e.every(function(n){return n.id===t}))throw new Error("Input tokens do not match the provided tokenID");for(var w,b=o(e);!(w=b()).done;)y+=BigInt(w.value.amt);for(var S,k=o(a);!(S=k()).done;)P+=BigInt(S.value.amt);if(y<P)throw new Error("Not enough tokens to send");if((g=y-P)>0n){var O={address:f||u.toAddress().toString(),amt:g.toString()};a.push(O)}var T=a.map(function(r){var e,o={p:"bsv-20",op:"transfer",amt:r.amt};if(n===h.BSV20)e=i({},o,{tick:t});else{if(n!==h.BSV21)throw new Error("Invalid protocol");e=i({},o,{id:t})}return{address:r.address,inscription:{dataB64:Buffer.from(JSON.stringify(e)).toString("base64"),contentType:"application/bsv-20"}}});return Promise.resolve(l(r,e,s,u,T,c||s.toAddress().toString(),d,v,p,m,!1))}catch(n){return Promise.reject(n)}}});
//# sourceMappingURL=index.umd.js.map
