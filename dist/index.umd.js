!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@bsv/sdk"),require("sigma-protocol")):"function"==typeof define&&define.amd?define(["exports","@bsv/sdk","sigma-protocol"],n):n((r||self).js1SatOrd={},r.bsv,r.sigmaProtocol)}(this,function(r,n,e){function t(r,n){(null==n||n>r.length)&&(n=r.length);for(var e=0,t=Array(n);e<n;e++)t[e]=r[e];return t}function o(r,n){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(e)return(e=e.call(r)).next.bind(e);if(Array.isArray(r)||(e=function(r,n){if(r){if("string"==typeof r)return t(r,n);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){e&&(r=e);var o=0;return function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(){return i=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)({}).hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},i.apply(null,arguments)}function a(r,n){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},a(r,n)}var s=function(r){return Buffer.from(r).toString("hex")},u=/*#__PURE__*/function(r){function e(){return r.apply(this,arguments)||this}var t,o;return o=r,(t=e).prototype=Object.create(o.prototype),t.prototype.constructor=t,a(t,o),e.prototype.lock=function(r,e,t,o){var i="";if(void 0!==e&&void 0!==t){var a=s("ord"),u=Buffer.from(e,"base64").toString("hex").trim();if(!u)throw new Error("Invalid file data");var c=s(t);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+a+" OP_1 "+c+" OP_0 "+u+" OP_ENDIF"}var l=(i?i+" ":"")+(new n.P2PKH).lock(r).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){l=l+" OP_RETURN "+s("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+s("SET");for(var d=0,f=Object.entries(o);d<f.length;d++){var v=f[d],p=v[0],h=v[1];"cmd"!==p&&(l=l+" "+s(p)+" "+s(h))}}return n.LockingScript.fromASM(l)},e}(n.P2PKH),c=function(r,e){var t=n.fromUtxo(i({},r,{script:Buffer.from(r.script,"base64").toString("hex")}),e);return t.sourceTXID=r.txid,t},l=function(r,n){try{var t,o=function(r){if(t)return r;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==n?void 0:n.idKey,a=null==n?void 0:n.keyHost;if(i){var s=new e.Sigma(r).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==n?void 0:n.authToken,i=new e.Sigma(r);return function(r,n){try{var e=Promise.resolve(i.remoteSign(a,o)).then(function(r){return t=1,r.signedTx})}catch(r){return n(r)}return e&&e.then?e.then(void 0,n):e}(0,function(r){throw console.log(r),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(r){return Promise.reject(r)}};r.createOrdinals=function(r,e,t,i,a,s,d,f){void 0===a&&(a=10),void 0===f&&(f=[]);try{for(var v,p=function(){return Promise.resolve(m.fee(h)).then(function(){return Promise.resolve(m.sign()).then(function(){return m})})},h=new n.SatoshisPerKilobyte(a),m=new n.Transaction,P=o(r);!(v=P()).done;){var g=c(v.value,(new n.P2PKH).unlock(t));m.addInput(g)}e.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var y,w=o(e);!(y=w()).done;){var S=y.value;if(!S.inscription)throw new Error("Inscription is required for all destinations");m.addOutput({satoshis:1,lockingScript:(new u).lock(S.address,S.inscription.dataB64,S.inscription.contentType,s)})}for(var b,k=o(f);!(b=k()).done;){var O=b.value;m.addOutput({satoshis:O.amount,lockingScript:(new n.P2PKH).lock(O.to)})}m.addOutput({lockingScript:(new n.P2PKH).lock(i||t.toAddress().toString()),change:!0});var K=function(){if(d)return Promise.resolve(l(m,d)).then(function(r){m=r})}();return Promise.resolve(K&&K.then?K.then(p):p())}catch(r){return Promise.reject(r)}},r.sendOrdinals=function(r,e,t,i,a,s,d,f,v,p,h){void 0===d&&(d=10),void 0===p&&(p=[]),void 0===h&&(h=!0);try{for(var m,P=function(){return Promise.resolve(y.fee(g)).then(function(){return Promise.resolve(y.sign()).then(function(){return y})})},g=new n.SatoshisPerKilobyte(d),y=new n.Transaction,w=o(e);!(m=w()).done;){var S=m.value;if(1!==S.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var b=c(S,(new u).unlock(i));y.addInput(b)}for(var k,O=o(r);!(k=O()).done;){var K=c(k.value,(new n.P2PKH).unlock(t));y.addInput(K)}if(h&&a.length!==e.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var T,j=o(a);!(T=j()).done;){var x,A,H,I=T.value;H=null!=(x=I.inscription)&&x.dataB64&&null!=(A=I.inscription)&&A.contentType?(new u).lock(I.address,I.inscription.dataB64,I.inscription.contentType,f):(new n.P2PKH).lock(I.address),y.addOutput({satoshis:1,lockingScript:H})}for(var E,_=o(p);!(E=_()).done;){var M=E.value;console.log("Additional payment",M),y.addOutput({satoshis:M.amount,lockingScript:(new n.P2PKH).lock(M.to)})}var B=(new n.P2PKH).lock(s||t.toAddress().toString());y.addOutput({lockingScript:B,change:!0});var U=function(){if(v)return Promise.resolve(l(y,v)).then(function(r){y=r})}();return Promise.resolve(U&&U.then?U.then(P):P())}catch(r){return Promise.reject(r)}},r.sendUtxos=function(r,e,t,i){void 0===i&&(i=10);try{for(var a,s=new n.SatoshisPerKilobyte(i),u=new n.Transaction,l=o(r);!(a=l()).done;){var d=c(a.value,(new n.P2PKH).unlock(e));u.addInput(d)}for(var f,v=o(t);!(f=v()).done;){var p=f.value,h={satoshis:p.amount,lockingScript:(new n.P2PKH).lock(p.to)};u.addOutput(h)}var m=e.toAddress().toString(),P=(new n.P2PKH).lock(m);return u.addOutput({lockingScript:P,change:!0}),Promise.resolve(u.fee(s)).then(function(){return Promise.resolve(u.sign()).then(function(){return u})})}catch(r){return Promise.reject(r)}}});
//# sourceMappingURL=index.umd.js.map
