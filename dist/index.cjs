var r=require("@bsv/sdk"),n=require("sigma-protocol");function t(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function e(r,n){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(e)return(e=e.call(r)).next.bind(e);if(Array.isArray(r)||(e=function(r,n){if(r){if("string"==typeof r)return t(r,n);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){e&&(r=e);var o=0;return function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return o=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)({}).hasOwnProperty.call(t,e)&&(r[e]=t[e])}return r},o.apply(null,arguments)}function i(r,n){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},i(r,n)}var a=function(r){return Buffer.from(r).toString("hex")},s=/*#__PURE__*/function(n){function t(){return n.apply(this,arguments)||this}var e,o;return o=n,(e=t).prototype=Object.create(o.prototype),e.prototype.constructor=e,i(e,o),t.prototype.lock=function(n,t,e,o){var i="";if(void 0!==t&&void 0!==e){var s=a("ord"),u=Buffer.from(t,"base64").toString("hex").trim();if(!u)throw new Error("Invalid file data");var c=a(e);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+s+" OP_1 "+c+" OP_0 "+u+" OP_ENDIF"}var f=(i?i+" ":"")+(new r.P2PKH).lock(n).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){f=f+" OP_RETURN "+a("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+a("SET");for(var l=0,d=Object.entries(o);l<d.length;l++){var v=d[l],h=v[0],p=v[1];"cmd"!==h&&(f=f+" "+a(h)+" "+a(p))}}return r.LockingScript.fromASM(f)},t}(r.P2PKH),u=function(n,t){var e=r.fromUtxo(o({},n,{script:Buffer.from(n.script,"base64").toString("hex")}),t);return e.sourceTXID=n.txid,e},c=function(r,t){try{var e,o=function(r){if(e)return r;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==t?void 0:t.idKey,a=null==t?void 0:t.keyHost;if(i){var s=new n.Sigma(r).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==t?void 0:t.authToken,i=new n.Sigma(r);return function(r,n){try{var t=Promise.resolve(i.remoteSign(a,o)).then(function(r){return e=1,r.signedTx})}catch(r){return n(r)}return t&&t.then?t.then(void 0,n):t}(0,function(r){throw console.log(r),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(r){return Promise.reject(r)}},f=function(n,t,o,i,a,f,l,d,v,h,p){void 0===l&&(l=10),void 0===h&&(h=[]),void 0===p&&(p=!0);try{for(var m,g=function(){return Promise.resolve(P.fee(y)).then(function(){return Promise.resolve(P.sign()).then(function(){return P})})},y=new r.SatoshisPerKilobyte(l),P=new r.Transaction,w=e(t);!(m=w()).done;){var S=m.value;if(1!==S.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var b=u(S,(new s).unlock(i));P.addInput(b)}if(p&&a.length!==t.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var k,O=e(a);!(k=O()).done;){var I,K,T,E=k.value;T=null!=(I=E.inscription)&&I.dataB64&&null!=(K=E.inscription)&&K.contentType?(new s).lock(E.address,E.inscription.dataB64,E.inscription.contentType,d):(new r.P2PKH).lock(E.address),P.addOutput({satoshis:1,lockingScript:T})}for(var x,A=e(h);!(x=A()).done;){var B=x.value;console.log("Additional payment",B),P.addOutput({satoshis:B.amount,lockingScript:(new r.P2PKH).lock(B.to)})}for(var j,H=e(n);!(j=H()).done;){var _=u(j.value,(new r.P2PKH).unlock(o));P.addInput(_)}var M=(new r.P2PKH).lock(f||o.toAddress().toString());P.addOutput({lockingScript:M,change:!0});var N=function(){if(v)return Promise.resolve(c(P,v)).then(function(r){P=r})}();return Promise.resolve(N&&N.then?N.then(g):g())}catch(r){return Promise.reject(r)}};const l="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function d(r,n,t){if(!r.s){if(t instanceof h){if(!t.s)return void(t.o=d.bind(null,r,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(d.bind(null,r,n),d.bind(null,r,2));r.s=n,r.v=t;var e=r.o;e&&e(r)}}var v,h=/*#__PURE__*/function(){function r(){}return r.prototype.then=function(n,t){var e=new r,o=this.s;if(o){var i=1&o?n:t;if(i){try{d(e,1,i(this.v))}catch(r){d(e,2,r)}return e}return this}return this.o=function(r){try{var o=r.v;1&r.s?d(e,1,n?n(o):o):t?d(e,1,t(o)):d(e,2,o)}catch(r){d(e,2,r)}},e},r}();function p(r){return r instanceof h&&1&r.s}!function(r){r.BSV20="bsv20",r.BSV21="bsv21"}(v||(v={})),exports.createOrdinals=function(n,t,o,i,a,f,l,d){void 0===a&&(a=10),void 0===d&&(d=[]);try{for(var v,h=function(){return Promise.resolve(m.fee(p)).then(function(){return Promise.resolve(m.sign()).then(function(){return m})})},p=new r.SatoshisPerKilobyte(a),m=new r.Transaction,g=e(n);!(v=g()).done;){var y=u(v.value,(new r.P2PKH).unlock(o));m.addInput(y)}t.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var P,w=e(t);!(P=w()).done;){var S=P.value;if(!S.inscription)throw new Error("Inscription is required for all destinations");m.addOutput({satoshis:1,lockingScript:(new s).lock(S.address,S.inscription.dataB64,S.inscription.contentType,f)})}for(var b,k=e(d);!(b=k()).done;){var O=b.value;m.addOutput({satoshis:O.amount,lockingScript:(new r.P2PKH).lock(O.to)})}m.addOutput({lockingScript:(new r.P2PKH).lock(i||o.toAddress().toString()),change:!0});var I=function(){if(l)return Promise.resolve(c(m,l)).then(function(r){m=r})}();return Promise.resolve(I&&I.then?I.then(h):h())}catch(r){return Promise.reject(r)}},exports.sendOrdinals=f,exports.sendUtxos=function(n,t,o,i){void 0===i&&(i=10);try{for(var a,s,c=function(){if(P<w+S)throw new Error("Not enough funds to deploy token. Total sats in: "+P+", Total sats out: "+w+", Fee: "+S);if(P>w+S){var n=t.toAddress().toString(),e=(new r.P2PKH).lock(n);v.addOutput({lockingScript:e,change:!0})}else P<w+S&&console.log("No change needed");return Promise.resolve(v.fee(f)).then(function(){return Promise.resolve(v.sign()).then(function(){return v})})},f=new r.SatoshisPerKilobyte(i),v=new r.Transaction,m=e(o);!(s=m()).done;){var g=s.value,y={satoshis:g.amount,lockingScript:(new r.P2PKH).lock(g.to)};v.addOutput(y)}var P=0n,w=v.outputs.reduce(function(r,n){return r+(n.satoshis||0)},0),S=0,b=function(r,n,t){if("function"==typeof r[l]){var e,o,i,a=r[l]();if(function r(s){try{for(;!((e=a.next()).done||t&&t());)if((s=n(e.value))&&s.then){if(!p(s))return void s.then(r,i||(i=d.bind(null,o=new h,2)));s=s.v}o?d(o,1,s):o=s}catch(r){d(o||(o=new h),2,r)}}(),a.return){var s=function(r){try{e.done||a.return()}catch(r){}return r};if(o&&o.then)return o.then(s,function(r){throw s(r)});s()}return o}if(!("length"in r))throw new TypeError("Object is not iterable");for(var u=[],c=0;c<r.length;c++)u.push(r[c]);return function(r,n,t){var e,o,i=-1;return function a(s){try{for(;++i<r.length&&(!t||!t());)if((s=n(i))&&s.then){if(!p(s))return void s.then(a,o||(o=d.bind(null,e=new h,2)));s=s.v}e?d(e,1,s):e=s}catch(r){d(e||(e=new h),2,r)}}(),e}(u,function(r){return n(u[r])},t)}(n,function(n){var e=u(n,(new r.P2PKH).unlock(t));return v.addInput(e),P+=BigInt(n.satoshis),Promise.resolve(f.computeFee(v)).then(function(r){P>=w+(S=r)&&(a=1)})},function(){return a});return Promise.resolve(b&&b.then?b.then(c):c())}catch(r){return Promise.reject(r)}},exports.transferOrdTokens=function(r,n,t,i,a,s,u,c,l,d,h,p,m){void 0===d&&(d=10),void 0===m&&(m=[]);try{var g=0n,y=0n,P=0n;if(!i.every(function(r){return r.id===n}))throw new Error("Input tokens do not match the provided tokenID");for(var w,S=e(i);!(w=S()).done;)y+=BigInt(w.value.amt);for(var b,k=e(a);!(b=k()).done;)P+=BigInt(b.value.amt);if(y<P)throw new Error("Not enough tokens to send");if((g=y-P)>0n){var O={address:l||u.toAddress().toString(),amt:g.toString()};a.push(O)}var I=a.map(function(t){var e,i={p:"bsv-20",op:"transfer",amt:t.amt};if(r===v.BSV20)e=o({},i,{tick:n});else{if(r!==v.BSV21)throw new Error("Invalid protocol");e=o({},i,{id:n})}return{address:t.address,inscription:{dataB64:Buffer.from(JSON.stringify(e)).toString("base64"),contentType:"application/bsv-20"}}});return Promise.resolve(f(t,i,s,u,I,c||s.toAddress().toString(),d,h,p,m,!1))}catch(r){return Promise.reject(r)}};
//# sourceMappingURL=index.cjs.map
