var r=require("@bsv/sdk"),n=require("sigma-protocol");function t(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function e(r,n){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(e)return(e=e.call(r)).next.bind(e);if(Array.isArray(r)||(e=function(r,n){if(r){if("string"==typeof r)return t(r,n);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){e&&(r=e);var o=0;return function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return o=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)({}).hasOwnProperty.call(t,e)&&(r[e]=t[e])}return r},o.apply(null,arguments)}function i(r,n){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},i(r,n)}var a=function(r){return Buffer.from(r).toString("hex")},s=/*#__PURE__*/function(n){function t(){return n.apply(this,arguments)||this}var e,o;return o=n,(e=t).prototype=Object.create(o.prototype),e.prototype.constructor=e,i(e,o),t.prototype.lock=function(n,t,e,o){var i="";if(void 0!==t&&void 0!==e){var s=a("ord"),u=Buffer.from(t,"base64").toString("hex").trim();if(!u)throw new Error("Invalid file data");var c=a(e);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+s+" OP_1 "+c+" OP_0 "+u+" OP_ENDIF"}var l=(i?i+" ":"")+(new r.P2PKH).lock(n).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){l=l+" OP_RETURN "+a("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+a("SET");for(var d=0,f=Object.entries(o);d<f.length;d++){var v=f[d],p=v[0],h=v[1];"cmd"!==p&&(l=l+" "+a(p)+" "+a(h))}}return r.LockingScript.fromASM(l)},t}(r.P2PKH),u=function(n,t){var e=r.fromUtxo(o({},n,{script:Buffer.from(n.script,"base64").toString("hex")}),t);return e.sourceTXID=n.txid,e},c=function(r,t){try{var e,o=function(r){if(e)return r;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==t?void 0:t.idKey,a=null==t?void 0:t.keyHost;if(i){var s=new n.Sigma(r).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==t?void 0:t.authToken,i=new n.Sigma(r);return function(r,n){try{var t=Promise.resolve(i.remoteSign(a,o)).then(function(r){return e=1,r.signedTx})}catch(r){return n(r)}return t&&t.then?t.then(void 0,n):t}(0,function(r){throw console.log(r),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(r){return Promise.reject(r)}};exports.createOrdinals=function(n,t,o,i,a,l,d,f){void 0===a&&(a=10),void 0===f&&(f=[]);try{for(var v,p=function(){return Promise.resolve(P.fee(h)).then(function(){return Promise.resolve(P.sign()).then(function(){return P})})},h=new r.SatoshisPerKilobyte(a),P=new r.Transaction,m=e(n);!(v=m()).done;){var g=u(v.value,(new r.P2PKH).unlock(o));P.addInput(g)}t.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var w,y=e(t);!(w=y()).done;){var S=w.value;if(!S.inscription)throw new Error("Inscription is required for all destinations");P.addOutput({satoshis:1,lockingScript:(new s).lock(S.address,S.inscription.dataB64,S.inscription.contentType,l)})}for(var b,k=e(f);!(b=k()).done;){var O=b.value;P.addOutput({satoshis:O.amount,lockingScript:(new r.P2PKH).lock(O.to)})}P.addOutput({lockingScript:(new r.P2PKH).lock(i||o.toAddress().toString()),change:!0});var K=function(){if(d)return Promise.resolve(c(P,d)).then(function(r){P=r})}();return Promise.resolve(K&&K.then?K.then(p):p())}catch(r){return Promise.reject(r)}},exports.sendOrdinals=function(n,t,o,i,a,l,d,f,v,p,h){void 0===d&&(d=10),void 0===p&&(p=[]),void 0===h&&(h=!0);try{for(var P,m=function(){return Promise.resolve(w.fee(g)).then(function(){return Promise.resolve(w.sign()).then(function(){return w})})},g=new r.SatoshisPerKilobyte(d),w=new r.Transaction,y=e(t);!(P=y()).done;){var S=P.value;if(1!==S.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var b=u(S,(new s).unlock(i));w.addInput(b)}for(var k,O=e(n);!(k=O()).done;){var K=u(k.value,(new r.P2PKH).unlock(o));w.addInput(K)}if(h&&a.length!==t.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var x,A=e(a);!(x=A()).done;){var H,I,T,j=x.value;T=null!=(H=j.inscription)&&H.dataB64&&null!=(I=j.inscription)&&I.contentType?(new s).lock(j.address,j.inscription.dataB64,j.inscription.contentType,f):(new r.P2PKH).lock(j.address),w.addOutput({satoshis:1,lockingScript:T})}for(var E,_=e(p);!(E=_()).done;){var M=E.value;console.log("Additional payment",M),w.addOutput({satoshis:M.amount,lockingScript:(new r.P2PKH).lock(M.to)})}var B=(new r.P2PKH).lock(l||o.toAddress().toString());w.addOutput({lockingScript:B,change:!0});var U=function(){if(v)return Promise.resolve(c(w,v)).then(function(r){w=r})}();return Promise.resolve(U&&U.then?U.then(m):m())}catch(r){return Promise.reject(r)}},exports.sendUtxos=function(n,t,o,i){void 0===i&&(i=10);try{for(var a,s=new r.SatoshisPerKilobyte(i),c=new r.Transaction,l=e(n);!(a=l()).done;){var d=u(a.value,(new r.P2PKH).unlock(t));c.addInput(d)}for(var f,v=e(o);!(f=v()).done;){var p=f.value,h={satoshis:p.amount,lockingScript:(new r.P2PKH).lock(p.to)};c.addOutput(h)}var P=t.toAddress().toString(),m=(new r.P2PKH).lock(P);return c.addOutput({lockingScript:m,change:!0}),Promise.resolve(c.fee(s)).then(function(){return Promise.resolve(c.sign()).then(function(){return c})})}catch(r){return Promise.reject(r)}};
//# sourceMappingURL=index.cjs.map
