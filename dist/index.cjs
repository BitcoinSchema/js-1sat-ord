var n=require("@bsv/sdk"),r=require("sigma-protocol");function t(n,r){(null==r||r>n.length)&&(r=n.length);for(var t=0,e=Array(r);t<r;t++)e[t]=n[t];return e}function e(n,r){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,r){if(n){if("string"==typeof n)return t(n,r);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(n,r):void 0}}(n))||r&&n&&"number"==typeof n.length){e&&(n=e);var o=0;return function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return o=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var e in t)({}).hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},o.apply(null,arguments)}function i(n,r){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},i(n,r)}var a=function(n){for(var r=[],t=0,e=n.length;t<e;t++){var o=Number(n.charCodeAt(t)).toString(16);r.push(o)}return r.join("")},u=/*#__PURE__*/function(r){function t(){return r.apply(this,arguments)||this}var e,o;return o=r,(e=t).prototype=Object.create(o.prototype),e.prototype.constructor=e,i(e,o),t.prototype.lock=function(r,t,e,o){var i="";if(void 0!==t&&void 0!==e){var u=a("ord"),s=Buffer.from(t,"base64").toString("hex").trim();i="OP_0 OP_IF "+u+" OP_1 "+a(e)+" OP_0 "+(s?s+" ":"")+"OP_ENDIF"}var c=(i?i+" ":"")+(new n.P2PKH).lock(r).toASM();if(null!=o&&o.app&&null!=o&&o.type){c=c+" OP_RETURN "+a("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+a("SET");for(var l=0,d=Object.entries(o);l<d.length;l++){var f=d[l],v=f[0],p=f[1];"cmd"!==v&&(c=c+" "+a(v)+" "+a(p))}}return n.LockingScript.fromASM(c)},t}(n.P2PKH),s=function(r,t){return n.fromUtxo(o({},r,{script:Buffer.from(r.script,"base64").toString("hex")}),t)};exports.createOrdinals=function(t,o,i,a,c,l,d,f){void 0===f&&(f=[]);try{for(var v,p=function(n){return Promise.resolve(P.fee(h)).then(function(){return Promise.resolve(P.sign()).then(function(){return P})})},h=new n.SatoshisPerKilobyte(c||10),P=new n.Transaction,g=e(t);!(v=g()).done;){var m=s(v.value,(new n.P2PKH).unlock(i));P.addInput(m)}o.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var y,w=e(o);!(y=w()).done;){var b=y.value;if(!b.inscription)throw new Error("Inscription is required for all destinations");P.addOutput({satoshis:1,lockingScript:(new u).lock(b.address,b.inscription.dataB64,b.inscription.contentType,l)})}for(var k,S=e(f);!(k=S()).done;){var O=k.value;P.addOutput({satoshis:O.amount,lockingScript:(new n.P2PKH).lock(O.to)})}P.addOutput({lockingScript:(new n.P2PKH).lock(a),change:!0});var K=null==d?void 0:d.idKey,H=null==d?void 0:d.keyHost,j=function(){if(!K)return function(){if(H){var n=null==d?void 0:d.authToken,t=new r.Sigma(P);return function(r,e){try{var o=Promise.resolve(t.remoteSign(H,n)).then(function(n){P=n.signedTx})}catch(n){return e(n)}return o&&o.then?o.then(void 0,e):o}(0,function(n){throw console.log(n),new Error("Remote signing to "+H+" failed")})}}();var n=new r.Sigma(P).sign(K);P=n.signedTx}();return Promise.resolve(j&&j.then?j.then(p):p())}catch(n){return Promise.reject(n)}},exports.sendOrdinals=function(r,t,o,i,a,c,l,d,f){void 0===f&&(f=[]);try{for(var v,p=new n.SatoshisPerKilobyte(l||10),h=new n.Transaction,P=e(t);!(v=P()).done;){var g=s(v.value,(new u).unlock(a));h.addInput(g)}for(var m,y=e(r);!(m=y()).done;){var w=s(m.value,(new n.P2PKH).unlock(o));h.addInput(w)}if(c.length!==t.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var b,k=e(c);!(b=k()).done;){var S,O,K,H=b.value;K=null!=(S=H.inscription)&&S.dataB64&&null!=(O=H.inscription)&&O.contentType?(new u).lock(H.address,H.inscription.dataB64,H.inscription.contentType,d):(new n.P2PKH).lock(H.address),h.addOutput({satoshis:1,lockingScript:K})}for(var j,T=e(f);!(j=T()).done;){var x=j.value;h.addOutput({satoshis:x.amount,lockingScript:(new n.P2PKH).lock(x.to)})}var A=(new n.P2PKH).lock(i);return h.addOutput({lockingScript:A,change:!0}),Promise.resolve(h.fee(p)).then(function(){return Promise.resolve(h.sign()).then(function(){return h})})}catch(n){return Promise.reject(n)}},exports.sendUtxos=function(r,t,o,i,a){try{for(var u,c=new n.SatoshisPerKilobyte(a||10),l=new n.Transaction,d=e(r);!(u=d()).done;){var f=s(u.value,(new n.P2PKH).unlock(t));l.addInput(f)}var v={satoshis:i,lockingScript:(new n.P2PKH).lock(o)};l.addOutput(v);var p=t.toAddress().toString(),h=(new n.P2PKH).lock(p);return l.addOutput({lockingScript:h,change:!0}),Promise.resolve(l.fee(c)).then(function(){return Promise.resolve(l.sign()).then(function(){return l})})}catch(n){return Promise.reject(n)}};
//# sourceMappingURL=index.cjs.map
