var t=require("bsv-wasm"),r=require("buffer"),e=require("fs"),n=require("path"),o=require("os"),i=require("sigma-protocol");function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=/*#__PURE__*/s(e),u=/*#__PURE__*/s(n),c=/*#__PURE__*/s(o);function l(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function p(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return l(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const d=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function f(t){console.log(`[dotenv@16.0.3][DEBUG] ${t}`)}const g={config:function(t){let r=u.default.resolve(process.cwd(),".env"),e="utf8";const n=Boolean(t&&t.debug),o=Boolean(t&&t.override);var i;t&&(null!=t.path&&(r="~"===(i=t.path)[0]?u.default.join(c.default.homedir(),i.slice(1)):i),null!=t.encoding&&(e=t.encoding));try{const t=g.parse(a.default.readFileSync(r,{encoding:e}));return Object.keys(t).forEach(function(r){Object.prototype.hasOwnProperty.call(process.env,r)?(!0===o&&(process.env[r]=t[r]),n&&f(!0===o?`"${r}" is already defined in \`process.env\` and WAS overwritten`:`"${r}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[r]=t[r]}),{parsed:t}}catch(t){return n&&f(`Failed to load ${r} ${t.message}`),{error:t}}},parse:function(t){const r={};let e,n=t.toString();for(n=n.replace(/\r\n?/gm,"\n");null!=(e=d.exec(n));){const t=e[1];let n=e[2]||"";n=n.trim();const o=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(n=n.replace(/\\n/g,"\n"),n=n.replace(/\\r/g,"\r")),r[t]=n}return r}};var _=g.config,v=g.parse,m=g;m.config=_,m.parse=v;var h=function(t){for(var r=[],e=0,n=t.length;e<n;e++){var o=Number(t.charCodeAt(e)).toString(16);r.push(o)}return r.join("")};_();var x=function(e,n,o,i){var s="";if(void 0!==n&&void 0!==o){var a=h("ord"),u=r.Buffer.from(n,"base64").toString("hex");s="OP_0 OP_IF "+a+" OP_1 "+h(o)+" OP_0 "+u+" OP_ENDIF"}var c=e.get_locking_script().to_asm_string()+(s?" "+s:"");if(i&&null!=i&&i.app&&null!=i&&i.type){c=c+" OP_RETURN "+h("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+h("SET");for(var l=0,p=Object.entries(i);l<p.length;l++){var d=p[l],f=d[0],g=d[1];"cmd"!==f&&(c=c+" "+h(f)+" "+h(g))}}return t.Script.from_asm_string(c)};exports.buildInscription=x,exports.buildReinscriptionTemplate=function(e,n,o,i){try{var s=new t.Transaction(1,0),a=new t.TxIn(r.Buffer.from(e.txid,"hex"),e.vout,t.Script.from_asm_string(e.script));s.add_input(a);var u=x(t.P2PKHAddress.from_string(n),null==o?void 0:o.dataB64,null==o?void 0:o.contentType,i),c=new t.TxOut(BigInt(1),u);return s.add_output(c),Promise.resolve(s)}catch(t){return Promise.reject(t)}},exports.createOrdinal=function(e,n,o,s,a,u,c,l){try{var p=function(r){var n=d.sign(o,t.SigHash.ALL|t.SigHash.FORKID,0,t.Script.from_asm_string(e.script),BigInt(e.satoshis));return f.set_unlocking_script(t.Script.from_asm_string(n.to_hex()+" "+o.to_public_key().to_hex())),d.set_input(0,f),d},d=new t.Transaction(1,0),f=new t.TxIn(r.Buffer.from(e.txid,"hex"),e.vout,t.Script.from_asm_string(""));d.add_input(f);var g=x(t.P2PKHAddress.from_string(n),u.dataB64,u.contentType,c),_=new t.TxOut(BigInt(1),g);d.add_output(_);var v=t.P2PKHAddress.from_string(s).get_locking_script(),m=new t.TxOut(BigInt(1),v),h=Math.ceil(a*(d.get_size()+m.to_bytes().byteLength)),y=e.satoshis-1-h;if(y<0)throw new Error("Inadequate satoshis for fee");if(y>0){var S=new t.TxOut(BigInt(y),v);d.add_output(S)}var w=null==l?void 0:l.idKey,b=null==l?void 0:l.keyHost,I=function(){if(!w)return function(){if(b){var t=null==l?void 0:l.authToken,r=new i.Sigma(d);return function(e,n){try{var o=Promise.resolve(r.remoteSign(b,t)).then(function(t){d=t.signedTx})}catch(t){return n(t)}return o&&o.then?o.then(void 0,n):o}(0,function(t){throw console.log(t),new Error("Remote signing to "+b+" failed")})}}();var t=new i.Sigma(d).sign(w);d=t.signedTx}();return Promise.resolve(I&&I.then?I.then(p):p())}catch(t){return Promise.reject(t)}},exports.sendOrdinal=function(e,n,o,i,s,a,u,c,l){try{var p=new t.Transaction(1,0),d=new t.TxIn(r.Buffer.from(n.txid,"hex"),n.vout,t.Script.from_asm_string(""));p.add_input(d);var f,g=new t.TxIn(r.Buffer.from(e.txid,"hex"),e.vout,t.Script.from_asm_string(""));p.add_input(g);var _=t.P2PKHAddress.from_string(u);f=null!=c&&c.dataB64&&null!=c&&c.contentType?x(_,c.dataB64,c.contentType,l):_.get_locking_script();var v=new t.TxOut(BigInt(1),f);p.add_output(v);var m=t.P2PKHAddress.from_string(i).get_locking_script(),h=new t.TxOut(BigInt(1),m),y=Math.ceil(s*(p.get_size()+h.to_bytes().byteLength)),S=new t.TxOut(BigInt(e.satoshis-y),m);p.add_output(S);var w=p.sign(a,t.SigHash.InputOutput,0,t.Script.from_asm_string(n.script),BigInt(n.satoshis));d.set_unlocking_script(t.Script.from_asm_string(w.to_hex()+" "+a.to_public_key().to_hex())),p.set_input(0,d);var b=p.sign(o,t.SigHash.InputOutput,1,t.Script.from_asm_string(e.script),BigInt(e.satoshis));return g.set_unlocking_script(t.Script.from_asm_string(b.to_hex()+" "+o.to_public_key().to_hex())),p.set_input(1,g),Promise.resolve(p)}catch(t){return Promise.reject(t)}},exports.sendUtxos=function(e,n,o,i){try{for(var s,a=new t.Transaction(1,0),u=0,c=p(e||[]);!(s=c()).done;)u+=s.value.satoshis;var l=u-i;console.log({feeSats:i,satsIn:u,satsOut:l}),a.add_output(new t.TxOut(BigInt(l),o.get_locking_script()));for(var d,f=0,g=p(e||[]);!(d=g()).done;){var _=d.value;console.log({u:_});var v=new t.TxIn(r.Buffer.from(_.txid,"hex"),_.vout,t.Script.from_asm_string(""));console.log({inx:v}),v.set_satoshis(BigInt(_.satoshis)),a.add_input(v);var m=a.sign(n,t.SigHash.InputOutputs,f,t.Script.from_asm_string(_.script),BigInt(_.satoshis));v.set_unlocking_script(t.Script.from_asm_string(m.to_hex()+" "+n.to_public_key().to_hex())),a.set_input(f,v),f++}return Promise.resolve(a)}catch(t){return Promise.reject(t)}};
//# sourceMappingURL=index.cjs.map
