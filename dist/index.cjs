var t=require("bsv-wasm"),r=require("buffer"),e=require("dotenv"),n=require("sigma-protocol");function i(t){if(t&&t.__esModule)return t;var r=Object.create(null);return t&&Object.keys(t).forEach(function(e){if("default"!==e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}}),r.default=t,r}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function s(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return o(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=function(t){for(var r=[],e=0,n=t.length;e<n;e++){var i=Number(t.charCodeAt(e)).toString(16);r.push(i)}return r.join("")};/*#__PURE__*/i(e).config();var u=function(e,n,i,o){var s="";if(void 0!==n&&void 0!==i){var u=a("ord"),c=r.Buffer.from(n,"base64").toString("hex");s="OP_0 OP_IF "+u+" OP_1 "+a(i)+" OP_0 "+c+" OP_ENDIF"}var _=e.get_locking_script().to_asm_string()+(s?" "+s:"");if(o&&null!=o&&o.app&&null!=o&&o.type){_=_+" OP_RETURN "+a("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+a("SET");for(var f=0,g=Object.entries(o);f<g.length;f++){var l=g[f],p=l[0],d=l[1];"cmd"!==p&&(_=_+" "+a(p)+" "+a(d))}}return t.Script.from_asm_string(_)};exports.buildInscription=u,exports.createOrdinal=function(e,i,o,s,a,c,_,f){try{var g=function(r){var n=l.sign(o,t.SigHash.ALL|t.SigHash.FORKID,0,t.Script.from_asm_string(e.script),BigInt(e.satoshis));return p.set_unlocking_script(t.Script.from_asm_string(n.to_hex()+" "+o.to_public_key().to_hex())),l.set_input(0,p),l},l=new t.Transaction(1,0),p=new t.TxIn(r.Buffer.from(e.txid,"hex"),e.vout,t.Script.from_asm_string(""));l.add_input(p);var d=u(t.P2PKHAddress.from_string(i),c.dataB64,c.contentType,_),m=new t.TxOut(BigInt(1),d);l.add_output(m);var v=t.P2PKHAddress.from_string(s).get_locking_script(),h=new t.TxOut(BigInt(1),v),x=Math.ceil(a*(l.get_size()+h.to_bytes().byteLength)),y=e.satoshis-1-x;if(y<0)throw new Error("Inadequate satoshis for fee");if(y>0){var S=new t.TxOut(BigInt(y),v);l.add_output(S)}var b=null==f?void 0:f.idKey,I=null==f?void 0:f.keyHost,O=function(){if(!b)return function(){if(I){var t=null==f?void 0:f.authToken,r=new n.Sigma(l);return function(e,n){try{var i=Promise.resolve(r.remoteSign(I,t)).then(function(t){l=t.signedTx})}catch(t){return n(t)}return i&&i.then?i.then(void 0,n):i}(0,function(t){throw console.log(t),new Error("Remote signing to "+I+" failed")})}}();var t=new n.Sigma(l).sign(b);l=t.signedTx}();return Promise.resolve(O&&O.then?O.then(g):g())}catch(t){return Promise.reject(t)}},exports.reinscribeOrdinalTemplate=function(e,n,i,o){try{var s=new t.Transaction(1,0),a=new t.TxIn(r.Buffer.from(e.txid,"hex"),e.vout,t.Script.from_asm_string(e.script));s.add_input(a);var c=u(t.P2PKHAddress.from_string(n),null==i?void 0:i.dataB64,null==i?void 0:i.contentType,o),_=new t.TxOut(BigInt(1),c);return s.add_output(_),Promise.resolve(s)}catch(t){return Promise.reject(t)}},exports.sendOrdinal=function(e,n,i,o,s,a,c,_,f){try{var g=new t.Transaction(1,0),l=new t.TxIn(r.Buffer.from(n.txid,"hex"),n.vout,t.Script.from_asm_string(""));g.add_input(l);var p,d=new t.TxIn(r.Buffer.from(e.txid,"hex"),e.vout,t.Script.from_asm_string(""));g.add_input(d);var m=t.P2PKHAddress.from_string(c);p=null!=_&&_.dataB64&&null!=_&&_.contentType?u(m,_.dataB64,_.contentType,f):m.get_locking_script();var v=new t.TxOut(BigInt(1),p);g.add_output(v);var h=t.P2PKHAddress.from_string(o).get_locking_script(),x=new t.TxOut(BigInt(1),h),y=Math.ceil(s*(g.get_size()+x.to_bytes().byteLength)),S=new t.TxOut(BigInt(e.satoshis-y),h);g.add_output(S);var b=g.sign(a,t.SigHash.InputOutput,0,t.Script.from_asm_string(n.script),BigInt(n.satoshis));l.set_unlocking_script(t.Script.from_asm_string(b.to_hex()+" "+a.to_public_key().to_hex())),g.set_input(0,l);var I=g.sign(i,t.SigHash.InputOutput,1,t.Script.from_asm_string(e.script),BigInt(e.satoshis));return d.set_unlocking_script(t.Script.from_asm_string(I.to_hex()+" "+i.to_public_key().to_hex())),g.set_input(1,d),Promise.resolve(g)}catch(t){return Promise.reject(t)}},exports.sendUtxos=function(e,n,i,o){try{for(var a,u=new t.Transaction(1,0),c=0,_=s(e||[]);!(a=_()).done;)c+=a.value.satoshis;var f=c-o;console.log({feeSats:o,satsIn:c,satsOut:f}),u.add_output(new t.TxOut(BigInt(f),i.get_locking_script()));for(var g,l=0,p=s(e||[]);!(g=p()).done;){var d=g.value;console.log({u:d});var m=new t.TxIn(r.Buffer.from(d.txid,"hex"),d.vout,t.Script.from_asm_string(""));console.log({inx:m}),m.set_satoshis(BigInt(d.satoshis)),u.add_input(m);var v=u.sign(n,t.SigHash.InputOutputs,l,t.Script.from_asm_string(d.script),BigInt(d.satoshis));m.set_unlocking_script(t.Script.from_asm_string(v.to_hex()+" "+n.to_public_key().to_hex())),u.set_input(l,m),l++}return Promise.resolve(u)}catch(t){return Promise.reject(t)}};
//# sourceMappingURL=index.cjs.map
