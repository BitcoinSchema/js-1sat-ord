var r=require("@bsv/sdk"),t=require("sigma-protocol");function n(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=Array(t);n<t;n++)e[n]=r[n];return e}function e(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(e)return(e=e.call(r)).next.bind(e);if(Array.isArray(r)||(e=function(r,t){if(r){if("string"==typeof r)return n(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?n(r,t):void 0}}(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var o=0;return function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return o=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)({}).hasOwnProperty.call(n,e)&&(r[e]=n[e])}return r},o.apply(null,arguments)}function i(r,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,t){return r.__proto__=t,r},i(r,t)}var a,s=function(r){return Buffer.from(r).toString("hex")},u=/*#__PURE__*/function(t){function n(){return t.apply(this,arguments)||this}var e,o;return o=t,(e=n).prototype=Object.create(o.prototype),e.prototype.constructor=e,i(e,o),n.prototype.lock=function(t,n,e,o){var i="";if(void 0!==n&&void 0!==e){var a=s("ord"),u=Buffer.from(n,"base64").toString("hex").trim();if(!u)throw new Error("Invalid file data");var c=s(e);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+a+" OP_1 "+c+" OP_0 "+u+" OP_ENDIF"}var d=(i?i+" ":"")+(new r.P2PKH).lock(t).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){d=d+" OP_RETURN "+s("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+s("SET");for(var l=0,f=Object.entries(o);l<f.length;l++){var v=f[l],p=v[0],h=v[1];"cmd"!==p&&(d=d+" "+s(p)+" "+s(h))}}return r.LockingScript.fromASM(d)},n}(r.P2PKH),c=function(t,n){var e=r.fromUtxo(o({},t,{script:Buffer.from(t.script,"base64").toString("hex")}),n);return e.sourceTXID=t.txid,e},d=function(r,n){try{var e,o=function(r){if(e)return r;throw new Error("Signer must be a LocalSigner or RemoteSigner")},i=null==n?void 0:n.idKey,a=null==n?void 0:n.keyHost;if(i){var s=new t.Sigma(r).sign(i);return Promise.resolve(s.signedTx)}var u=function(){if(a){var o=null==n?void 0:n.authToken,i=new t.Sigma(r);return function(r,t){try{var n=Promise.resolve(i.remoteSign(a,o)).then(function(r){return e=1,r.signedTx})}catch(r){return t(r)}return n&&n.then?n.then(void 0,t):n}(0,function(r){throw console.log(r),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(u&&u.then?u.then(o):o(u))}catch(r){return Promise.reject(r)}},l=function(t,n,o,i,a,s,l,f,v,p,h){void 0===l&&(l=10),void 0===p&&(p=[]),void 0===h&&(h=!0);try{for(var m,g=function(){return Promise.resolve(w.fee(P)).then(function(){return Promise.resolve(w.sign()).then(function(){return w})})},P=new r.SatoshisPerKilobyte(l),w=new r.Transaction,y=e(n);!(m=y()).done;){var S=m.value;if(1!==S.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var b=c(S,(new u).unlock(i));w.addInput(b)}for(var k,O=e(t);!(k=O()).done;){var K=c(k.value,(new r.P2PKH).unlock(o));w.addInput(K)}if(h&&a.length!==n.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var I,A=e(a);!(I=A()).done;){var x,E,T,B=I.value;T=null!=(x=B.inscription)&&x.dataB64&&null!=(E=B.inscription)&&E.contentType?(new u).lock(B.address,B.inscription.dataB64,B.inscription.contentType,f):(new r.P2PKH).lock(B.address),w.addOutput({satoshis:1,lockingScript:T})}for(var j,H=e(p);!(j=H()).done;){var _=j.value;console.log("Additional payment",_),w.addOutput({satoshis:_.amount,lockingScript:(new r.P2PKH).lock(_.to)})}var M=(new r.P2PKH).lock(s||o.toAddress().toString());w.addOutput({lockingScript:M,change:!0});var U=function(){if(v)return Promise.resolve(d(w,v)).then(function(r){w=r})}();return Promise.resolve(U&&U.then?U.then(g):g())}catch(r){return Promise.reject(r)}};!function(r){r.BSV20="bsv20",r.BSV21="bsv21"}(a||(a={})),exports.createOrdinals=function(t,n,o,i,a,s,l,f){void 0===a&&(a=10),void 0===f&&(f=[]);try{for(var v,p=function(){return Promise.resolve(m.fee(h)).then(function(){return Promise.resolve(m.sign()).then(function(){return m})})},h=new r.SatoshisPerKilobyte(a),m=new r.Transaction,g=e(t);!(v=g()).done;){var P=c(v.value,(new r.P2PKH).unlock(o));m.addInput(P)}n.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var w,y=e(n);!(w=y()).done;){var S=w.value;if(!S.inscription)throw new Error("Inscription is required for all destinations");m.addOutput({satoshis:1,lockingScript:(new u).lock(S.address,S.inscription.dataB64,S.inscription.contentType,s)})}for(var b,k=e(f);!(b=k()).done;){var O=b.value;m.addOutput({satoshis:O.amount,lockingScript:(new r.P2PKH).lock(O.to)})}m.addOutput({lockingScript:(new r.P2PKH).lock(i||o.toAddress().toString()),change:!0});var K=function(){if(l)return Promise.resolve(d(m,l)).then(function(r){m=r})}();return Promise.resolve(K&&K.then?K.then(p):p())}catch(r){return Promise.reject(r)}},exports.sendOrdinals=l,exports.sendUtxos=function(t,n,o,i){void 0===i&&(i=10);try{for(var a,s=new r.SatoshisPerKilobyte(i),u=new r.Transaction,d=e(t);!(a=d()).done;){var l=c(a.value,(new r.P2PKH).unlock(n));u.addInput(l)}for(var f,v=e(o);!(f=v()).done;){var p=f.value,h={satoshis:p.amount,lockingScript:(new r.P2PKH).lock(p.to)};u.addOutput(h)}var m=n.toAddress().toString(),g=(new r.P2PKH).lock(m);return u.addOutput({lockingScript:g,change:!0}),Promise.resolve(u.fee(s)).then(function(){return Promise.resolve(u.sign()).then(function(){return u})})}catch(r){return Promise.reject(r)}},exports.transferOrdTokens=function(r,t,n,i,s,u,c,d,f,v,p,h,m){void 0===v&&(v=10),void 0===m&&(m=[]);try{var g=0n,P=0n,w=0n;if(!i.every(function(r){return r.id===t}))throw new Error("Input tokens do not match the provided tokenID");for(var y,S=e(i);!(y=S()).done;)P+=BigInt(y.value.amt);for(var b,k=e(s);!(b=k()).done;)w+=BigInt(b.value.amt);if(P<w)throw new Error("Not enough tokens to send");if((g=P-w)>0n){var O={address:f||c.toAddress().toString(),amt:g.toString()};s.push(O)}var K=s.map(function(n){var e,i={p:"bsv-20",op:"transfer",amt:n.amt};if(r===a.BSV20)e=o({},i,{tick:t});else{if(r!==a.BSV21)throw new Error("Invalid protocol");e=o({},i,{id:t})}return{address:n.address,inscription:{dataB64:Buffer.from(JSON.stringify(e)).toString("base64"),contentType:"application/bsv-20"}}});return Promise.resolve(l(n,i,u,c,K,d||u.toAddress().toString(),v,p,h,m,!1))}catch(r){return Promise.reject(r)}};
//# sourceMappingURL=index.cjs.map
