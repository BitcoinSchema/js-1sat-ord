var e=require("@bsv/sdk"),n=require("sigma-protocol");function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function t(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return r(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,n){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},o(e,n)}var i=function(e){for(var n=[],r=0,t=e.length;r<t;r++){var o=Number(e.charCodeAt(r)).toString(16);n.push(o)}return n.join("")},a=/*#__PURE__*/function(n){function r(){return n.apply(this,arguments)||this}var t,a;return a=n,(t=r).prototype=Object.create(a.prototype),t.prototype.constructor=t,o(t,a),r.prototype.lock=function(n,r,t,o){var a="";if(void 0!==r&&void 0!==t){var c=i("ord"),u=Buffer.from(r,"base64").toString("hex").trim();a="OP_0 OP_IF "+c+" OP_1 "+i(t)+" OP_0 "+(u?u+" ":"")+"OP_ENDIF"}var s=(a?a+" ":"")+(new e.P2PKH).lock(n).toASM();if(null!=o&&o.app&&null!=o&&o.type){s=s+" OP_RETURN "+i("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+i("SET");for(var l=0,v=Object.entries(o);l<v.length;l++){var p=v[l],f=p[0],h=p[1];"cmd"!==f&&(s=s+" "+i(f)+" "+i(h))}}return e.LockingScript.fromASM(s)},r}(e.P2PKH);exports.buildReinscriptionTemplate=function(n,r,t,o){try{var i={sourceTransaction:e.Transaction.fromHex(n.rawTxHex),sourceOutputIndex:n.vout,sequence:0},c=(new a).lock(r,null==t?void 0:t.dataB64,null==t?void 0:t.contentType,o);return Promise.resolve(new e.Transaction(1,[i],[{satoshis:1,lockingScript:c}],0))}catch(e){return Promise.reject(e)}},exports.createOrdinal=function(r,o,i,c,u,s,l,v,p){void 0===p&&(p=[]);try{var f=function(e){return Promise.resolve(b.fee(h)).then(function(){return Promise.resolve(b.sign()).then(function(){return b})})},h=new e.SatoshisPerKilobyte(s||10),d=r.map(function(n){return{sourceTransaction:e.Transaction.fromHex(n.rawTxHex),sourceOutputIndex:n.vout,unlockingScriptTemplate:(new e.P2PKH).unlock(i),sequence:4294967295}});u.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var m,P=[],g=t(u);!(m=g()).done;){var y=m.value,k=(new a).lock(o,y.dataB64,y.contentType,l);P.push({satoshis:1,lockingScript:k})}for(var S,w=t(p);!(S=w()).done;){var T=S.value;P.push({satoshis:T.amount,lockingScript:(new e.P2PKH).lock(T.to)})}var x=(new e.P2PKH).lock(c);P.push({lockingScript:x,change:!0});var b=new e.Transaction(1,d,P,0),H=null==v?void 0:v.idKey,O=null==v?void 0:v.keyHost,K=function(){if(!H)return function(){if(O){var e=null==v?void 0:v.authToken,r=new n.Sigma(b);return function(n,t){try{var o=Promise.resolve(r.remoteSign(O,e)).then(function(e){b=e.signedTx})}catch(e){return t(e)}return o&&o.then?o.then(void 0,t):o}(0,function(e){throw console.log(e),new Error("Remote signing to "+O+" failed")})}}();var e=new n.Sigma(b).sign(H);b=e.signedTx}();return Promise.resolve(K&&K.then?K.then(f):f())}catch(e){return Promise.reject(e)}},exports.sendUtxos=function(n,r,t,o,i){try{var a=new e.SatoshisPerKilobyte(o||10),c=n.map(function(n){return{sourceTransaction:e.Transaction.fromHex(n.rawTxHex),sourceOutputIndex:n.vout,unlockingScriptTemplate:(new e.P2PKH).unlock(r),sequence:4294967295}}),u=[],s={satoshis:i,lockingScript:(new e.P2PKH).lock(t)};u.push(s);var l=r.toAddress().toString(),v=(new e.P2PKH).lock(l);u.push({lockingScript:v,change:!0});var p=new e.Transaction(1,c,u,0);return Promise.resolve(p.fee(a)).then(function(){return Promise.resolve(p.sign()).then(function(){return p})})}catch(e){return Promise.reject(e)}},exports.transferOrdinal=function(n,r,o,i,c,u,s,l,v,p){void 0===p&&(p=[]);try{for(var f,h=new e.SatoshisPerKilobyte(s||10),d=[],m=t(r);!(f=m()).done;){var P=f.value,g=e.Transaction.fromHex(P.rawTxHex),y={sourceTransaction:g,sourceOutputIndex:P.vout,unlockingScriptTemplate:(new a).unlock(c,void 0,void 0,void 0,e.LockingScript.fromASM(g.outputs[P.vout].lockingScript.toASM())),sequence:4294967295};d.push(y)}for(var k,S=t(n);!(k=S()).done;){var w=k.value,T={sourceTransaction:e.Transaction.fromHex(w.rawTxHex),sourceOutputIndex:w.vout,unlockingScriptTemplate:(new e.P2PKH).unlock(o),sequence:4294967295};d.push(T)}for(var x=[],b=t(r);!b().done;){var H;H=null!=l&&l.dataB64&&null!=l&&l.contentType?(new a).lock(u,l.dataB64,l.contentType,v):(new e.P2PKH).lock(u),x.push({satoshis:1,lockingScript:H})}for(var O,K=t(p);!(O=K()).done;){var A=O.value;x.push({satoshis:A.amount,lockingScript:(new e.P2PKH).lock(A.to)})}var j=(new e.P2PKH).lock(i);x.push({lockingScript:j,change:!0});var I=new e.Transaction(1,d,x,0);return Promise.resolve(I.fee(h)).then(function(){return Promise.resolve(I.sign()).then(function(){return I})})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=index.cjs.map
