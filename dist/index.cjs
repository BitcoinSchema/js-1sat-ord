var r=require("@bsv/sdk"),n=require("sigma-protocol");function t(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function e(r,n){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(e)return(e=e.call(r)).next.bind(e);if(Array.isArray(r)||(e=function(r,n){if(r){if("string"==typeof r)return t(r,n);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){e&&(r=e);var o=0;return function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return o=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)({}).hasOwnProperty.call(t,e)&&(r[e]=t[e])}return r},o.apply(null,arguments)}function i(r,n){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},i(r,n)}var a=function(r){for(var n=[],t=0,e=r.length;t<e;t++){var o=Number(r.charCodeAt(t)).toString(16);n.push(o)}return n.join("")},u=/*#__PURE__*/function(n){function t(){return n.apply(this,arguments)||this}var e,o;return o=n,(e=t).prototype=Object.create(o.prototype),e.prototype.constructor=e,i(e,o),t.prototype.lock=function(n,t,e,o){var i="";if(void 0!==t&&void 0!==e){var u=a("ord"),s=Buffer.from(t,"base64").toString("hex").trim();if(!s)throw new Error("Invalid file data");var c=a(e);if(!c)throw new Error("Invalid media type");i="OP_0 OP_IF "+u+" OP_1 "+c+" OP_0 "+s+" OP_ENDIF"}var l=(i?i+" ":"")+(new r.P2PKH).lock(n).toASM();if(o&&(!o.app||!o.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=o&&o.app&&null!=o&&o.type){l=l+" OP_RETURN "+a("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+a("SET");for(var d=0,f=Object.entries(o);d<f.length;d++){var p=f[d],v=p[0],h=p[1];"cmd"!==v&&(l=l+" "+a(v)+" "+a(h))}}return r.LockingScript.fromASM(l)},t}(r.P2PKH),s=function(n,t){return r.fromUtxo(o({},n,{script:Buffer.from(n.script,"base64").toString("hex")}),t)};exports.createOrdinals=function(t,o,i,a,c,l,d,f){void 0===f&&(f=[]);try{for(var p,v=function(r){return Promise.resolve(P.fee(h)).then(function(){return Promise.resolve(P.sign()).then(function(){return P})})},h=new r.SatoshisPerKilobyte(c||10),P=new r.Transaction,g=e(t);!(p=g()).done;){var m=s(p.value,(new r.P2PKH).unlock(i));P.addInput(m)}o.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var y,w=e(o);!(y=w()).done;){var b=y.value;if(!b.inscription)throw new Error("Inscription is required for all destinations");P.addOutput({satoshis:1,lockingScript:(new u).lock(b.address,b.inscription.dataB64,b.inscription.contentType,l)})}for(var k,S=e(f);!(k=S()).done;){var O=k.value;P.addOutput({satoshis:O.amount,lockingScript:(new r.P2PKH).lock(O.to)})}P.addOutput({lockingScript:(new r.P2PKH).lock(a),change:!0});var K=null==d?void 0:d.idKey,H=null==d?void 0:d.keyHost,j=function(){if(!K)return function(){if(H){var r=null==d?void 0:d.authToken,t=new n.Sigma(P);return function(n,e){try{var o=Promise.resolve(t.remoteSign(H,r)).then(function(r){P=r.signedTx})}catch(r){return e(r)}return o&&o.then?o.then(void 0,e):o}(0,function(r){throw console.log(r),new Error("Remote signing to "+H+" failed")})}}();var r=new n.Sigma(P).sign(K);P=r.signedTx}();return Promise.resolve(j&&j.then?j.then(v):v())}catch(r){return Promise.reject(r)}},exports.sendOrdinals=function(n,t,o,i,a,c,l,d,f){void 0===f&&(f=[]);try{for(var p,v=new r.SatoshisPerKilobyte(l||10),h=new r.Transaction,P=e(t);!(p=P()).done;){var g=s(p.value,(new u).unlock(a));h.addInput(g)}for(var m,y=e(n);!(m=y()).done;){var w=s(m.value,(new r.P2PKH).unlock(o));h.addInput(w)}if(c.length!==t.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var b,k=e(c);!(b=k()).done;){var S,O,K,H=b.value;K=null!=(S=H.inscription)&&S.dataB64&&null!=(O=H.inscription)&&O.contentType?(new u).lock(H.address,H.inscription.dataB64,H.inscription.contentType,d):(new r.P2PKH).lock(H.address),h.addOutput({satoshis:1,lockingScript:K})}for(var j,A=e(f);!(j=A()).done;){var I=j.value;h.addOutput({satoshis:I.amount,lockingScript:(new r.P2PKH).lock(I.to)})}var T=(new r.P2PKH).lock(i);return h.addOutput({lockingScript:T,change:!0}),Promise.resolve(h.fee(v)).then(function(){return Promise.resolve(h.sign()).then(function(){return h})})}catch(r){return Promise.reject(r)}},exports.sendUtxos=function(n,t,o,i,a){try{for(var u,c=new r.SatoshisPerKilobyte(a||10),l=new r.Transaction,d=e(n);!(u=d()).done;){var f=s(u.value,(new r.P2PKH).unlock(t));l.addInput(f)}var p={satoshis:i,lockingScript:(new r.P2PKH).lock(o)};l.addOutput(p);var v=t.toAddress().toString(),h=(new r.P2PKH).lock(v);return l.addOutput({lockingScript:h,change:!0}),Promise.resolve(l.fee(c)).then(function(){return Promise.resolve(l.sign()).then(function(){return l})})}catch(r){return Promise.reject(r)}};
//# sourceMappingURL=index.cjs.map
