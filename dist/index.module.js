import{P2PKH as r,LockingScript as n,fromUtxo as t,SatoshisPerKilobyte as e,Transaction as o}from"@bsv/sdk";import{Sigma as i}from"sigma-protocol";function a(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function u(r,n){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=function(r,n){if(r){if("string"==typeof r)return a(r,n);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){t&&(r=t);var e=0;return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){return c=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)({}).hasOwnProperty.call(t,e)&&(r[e]=t[e])}return r},c.apply(null,arguments)}function s(r,n){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},s(r,n)}var l=function(r){return Buffer.from(r).toString("hex")},d=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}var o,i;return i=t,(o=e).prototype=Object.create(i.prototype),o.prototype.constructor=o,s(o,i),e.prototype.lock=function(t,e,o,i){var a="";if(void 0!==e&&void 0!==o){var u=l("ord"),c=Buffer.from(e,"base64").toString("hex").trim();if(!c)throw new Error("Invalid file data");var s=l(o);if(!s)throw new Error("Invalid media type");a="OP_0 OP_IF "+u+" OP_1 "+s+" OP_0 "+c+" OP_ENDIF"}var d=(a?a+" ":"")+(new r).lock(t).toASM();if(i&&(!i.app||!i.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=i&&i.app&&null!=i&&i.type){d=d+" OP_RETURN "+l("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+l("SET");for(var f=0,v=Object.entries(i);f<v.length;f++){var p=v[f],h=p[0],m=p[1];"cmd"!==h&&(d=d+" "+l(h)+" "+l(m))}}return n.fromASM(d)},e}(r),f=function(r,n){var e=t(c({},r,{script:Buffer.from(r.script,"base64").toString("hex")}),n);return e.sourceTXID=r.txid,e},v=function(n,t,a,c,s,l,v,p){void 0===s&&(s=10),void 0===p&&(p=[]);try{for(var h,m=function(r){return Promise.resolve(w.fee(g)).then(function(){return Promise.resolve(w.sign()).then(function(){return w})})},g=new e(s),w=new o,y=u(n);!(h=y()).done;){var k=f(h.value,(new r).unlock(a));w.addInput(k)}t.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var b,O=u(t);!(b=O()).done;){var P=b.value;if(!P.inscription)throw new Error("Inscription is required for all destinations");w.addOutput({satoshis:1,lockingScript:(new d).lock(P.address,P.inscription.dataB64,P.inscription.contentType,l)})}for(var S,I=u(p);!(S=I()).done;){var j=S.value;w.addOutput({satoshis:j.amount,lockingScript:(new r).lock(j.to)})}w.addOutput({lockingScript:(new r).lock(c),change:!0});var A=null==v?void 0:v.idKey,E=null==v?void 0:v.keyHost,T=function(){if(!A)return function(){if(E){var r=null==v?void 0:v.authToken,n=new i(w);return function(t,e){try{var o=Promise.resolve(n.remoteSign(E,r)).then(function(r){w=r.signedTx})}catch(r){return e(r)}return o&&o.then?o.then(void 0,e):o}(0,function(r){throw console.log(r),new Error("Remote signing to "+E+" failed")})}}();var r=new i(w).sign(A);w=r.signedTx}();return Promise.resolve(T&&T.then?T.then(m):m())}catch(r){return Promise.reject(r)}},p=function(n,t,i,a,c,s,l,v,p){void 0===l&&(l=10),void 0===p&&(p=[]);try{for(var h,m=new e(l),g=new o,w=u(t);!(h=w()).done;){var y=f(h.value,(new d).unlock(c));g.addInput(y)}for(var k,b=u(n);!(k=b()).done;){var O=f(k.value,(new r).unlock(i));g.addInput(O)}if(s.length!==t.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var P,S=u(s);!(P=S()).done;){var I,j,A,E=P.value;A=null!=(I=E.inscription)&&I.dataB64&&null!=(j=E.inscription)&&j.contentType?(new d).lock(E.address,E.inscription.dataB64,E.inscription.contentType,v):(new r).lock(E.address),g.addOutput({satoshis:1,lockingScript:A})}for(var T,_=u(p);!(T=_()).done;){var x=T.value;g.addOutput({satoshis:x.amount,lockingScript:(new r).lock(x.to)})}var M=(new r).lock(a);return g.addOutput({lockingScript:M,change:!0}),Promise.resolve(g.fee(m)).then(function(){return Promise.resolve(g.sign()).then(function(){return g})})}catch(r){return Promise.reject(r)}},h=function(n,t,i,a,c){void 0===c&&(c=10);try{for(var s,l=new e(c),d=new o,v=u(n);!(s=v()).done;){var p=f(s.value,(new r).unlock(t));d.addInput(p)}var h={satoshis:a,lockingScript:(new r).lock(i)};d.addOutput(h);var m=t.toAddress().toString(),g=(new r).lock(m);return d.addOutput({lockingScript:g,change:!0}),Promise.resolve(d.fee(l)).then(function(){return Promise.resolve(d.sign()).then(function(){return d})})}catch(r){return Promise.reject(r)}};export{v as createOrdinals,p as sendOrdinals,h as sendUtxos};
//# sourceMappingURL=index.module.js.map
