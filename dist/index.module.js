import{P2PKH as e,LockingScript as n,Transaction as r,SatoshisPerKilobyte as t}from"@bsv/sdk";import{Sigma as o}from"sigma-protocol";function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=Array(n);r<n;r++)t[r]=e[r];return t}function u(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return i(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,n){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},c(e,n)}var a=function(e){for(var n=[],r=0,t=e.length;r<t;r++){var o=Number(e.charCodeAt(r)).toString(16);n.push(o)}return n.join("")},s=/*#__PURE__*/function(r){function t(){return r.apply(this,arguments)||this}var o,i;return i=r,(o=t).prototype=Object.create(i.prototype),o.prototype.constructor=o,c(o,i),t.prototype.lock=function(r,t,o,i){var u="";if(void 0!==t&&void 0!==o){var c=a("ord"),s=Buffer.from(t,"base64").toString("hex").trim();u="OP_0 OP_IF "+c+" OP_1 "+a(o)+" OP_0 "+(s?s+" ":"")+"OP_ENDIF"}var l=(u?u+" ":"")+(new e).lock(r).toASM();if(null!=i&&i.app&&null!=i&&i.type){l=l+" OP_RETURN "+a("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+a("SET");for(var v=0,p=Object.entries(i);v<p.length;v++){var f=p[v],h=f[0],m=f[1];"cmd"!==h&&(l=l+" "+a(h)+" "+a(m))}}return n.fromASM(l)},t}(e),l=function(e,n,t,o){try{var i={sourceTransaction:r.fromHex(e.rawTxHex),sourceOutputIndex:e.vout,sequence:0},u=(new s).lock(n,null==t?void 0:t.dataB64,null==t?void 0:t.contentType,o);return Promise.resolve(new r(1,[i],[{satoshis:1,lockingScript:u}],0))}catch(e){return Promise.reject(e)}},v=function(n,i,c,a,l,v,p,f,h){void 0===h&&(h=[]);try{var m=function(e){return Promise.resolve(A.fee(d)).then(function(){return Promise.resolve(A.sign()).then(function(){return A})})},d=new t(v||10),g=n.map(function(n){return{sourceTransaction:r.fromHex(n.rawTxHex),sourceOutputIndex:n.vout,unlockingScriptTemplate:(new e).unlock(c),sequence:4294967295}});l.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var w,k=[],y=u(l);!(w=y()).done;){var S=w.value,x=(new s).lock(i,S.dataB64,S.contentType,p);k.push({satoshis:1,lockingScript:x})}for(var T,P=u(h);!(T=P()).done;){var b=T.value;k.push({satoshis:b.amount,lockingScript:(new e).lock(b.to)})}var O=(new e).lock(a);k.push({lockingScript:O,change:!0});var A=new r(1,g,k,0),j=null==f?void 0:f.idKey,H=null==f?void 0:f.keyHost,I=function(){if(!j)return function(){if(H){var e=null==f?void 0:f.authToken,n=new o(A);return function(r,t){try{var o=Promise.resolve(n.remoteSign(H,e)).then(function(e){A=e.signedTx})}catch(e){return t(e)}return o&&o.then?o.then(void 0,t):o}(0,function(e){throw console.log(e),new Error("Remote signing to "+H+" failed")})}}();var e=new o(A).sign(j);A=e.signedTx}();return Promise.resolve(I&&I.then?I.then(m):m())}catch(e){return Promise.reject(e)}},p=function(o,i,c,a,l,v,p,f,h,m){void 0===m&&(m=[]);try{for(var d,g=new t(p||10),w=[],k=u(i);!(d=k()).done;){var y=d.value,S=r.fromHex(y.rawTxHex),x={sourceTransaction:S,sourceOutputIndex:y.vout,unlockingScriptTemplate:(new s).unlock(l,void 0,void 0,void 0,n.fromASM(S.outputs[y.vout].lockingScript.toASM())),sequence:4294967295};w.push(x)}for(var T,P=u(o);!(T=P()).done;){var b=T.value,O={sourceTransaction:r.fromHex(b.rawTxHex),sourceOutputIndex:b.vout,unlockingScriptTemplate:(new e).unlock(c),sequence:4294967295};w.push(O)}for(var A=[],j=u(i);!j().done;){var H;H=null!=f&&f.dataB64&&null!=f&&f.contentType?(new s).lock(v,f.dataB64,f.contentType,h):(new e).lock(v),A.push({satoshis:1,lockingScript:H})}for(var I,_=u(m);!(I=_()).done;){var M=I.value;A.push({satoshis:M.amount,lockingScript:(new e).lock(M.to)})}var q=(new e).lock(a);A.push({lockingScript:q,change:!0});var B=new r(1,w,A,0);return Promise.resolve(B.fee(g)).then(function(){return Promise.resolve(B.sign()).then(function(){return B})})}catch(e){return Promise.reject(e)}},f=function(n,o,i,u,c){try{var a=new t(u||10),s=n.map(function(n){return{sourceTransaction:r.fromHex(n.rawTxHex),sourceOutputIndex:n.vout,unlockingScriptTemplate:(new e).unlock(o),sequence:4294967295}}),l=[],v={satoshis:c,lockingScript:(new e).lock(i)};l.push(v);var p=o.toAddress().toString(),f=(new e).lock(p);l.push({lockingScript:f,change:!0});var h=new r(1,s,l,0);return Promise.resolve(h.fee(a)).then(function(){return Promise.resolve(h.sign()).then(function(){return h})})}catch(e){return Promise.reject(e)}};export{l as buildReinscriptionTemplate,v as createOrdinal,f as sendUtxos,p as transferOrdinal};
//# sourceMappingURL=index.module.js.map
