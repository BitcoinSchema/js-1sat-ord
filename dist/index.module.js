import{P2PKH as n,LockingScript as r,SatoshisPerKilobyte as t,Transaction as e,fromUtxo as o}from"@bsv/sdk";import{Sigma as i}from"sigma-protocol";function a(n,r){(null==r||r>n.length)&&(r=n.length);for(var t=0,e=Array(r);t<r;t++)e[t]=n[t];return e}function u(n,r){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=function(n,r){if(n){if("string"==typeof n)return a(n,r);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(n,r):void 0}}(n))||r&&n&&"number"==typeof n.length){t&&(n=t);var e=0;return function(){return e>=n.length?{done:!0}:{done:!1,value:n[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){return c=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var e in t)({}).hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},c.apply(null,arguments)}function s(n,r){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},s(n,r)}var l=function(n){for(var r=[],t=0,e=n.length;t<e;t++){var o=Number(n.charCodeAt(t)).toString(16);r.push(o)}return r.join("")},d=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}var o,i;return i=t,(o=e).prototype=Object.create(i.prototype),o.prototype.constructor=o,s(o,i),e.prototype.lock=function(t,e,o,i){var a="";if(void 0!==e&&void 0!==o){var u=l("ord"),c=Buffer.from(e,"base64").toString("hex").trim();a="OP_0 OP_IF "+u+" OP_1 "+l(o)+" OP_0 "+(c?c+" ":"")+"OP_ENDIF"}var s=(a?a+" ":"")+(new n).lock(t).toASM();if(null!=i&&i.app&&null!=i&&i.type){s=s+" OP_RETURN "+l("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+l("SET");for(var d=0,f=Object.entries(i);d<f.length;d++){var v=f[d],p=v[0],h=v[1];"cmd"!==p&&(s=s+" "+l(p)+" "+l(h))}}return r.fromASM(s)},e}(n),f=function(r,o,a,c,s,l,f,v){void 0===v&&(v=[]);try{for(var p,h=function(n){return Promise.resolve(y.fee(m)).then(function(){return Promise.resolve(y.sign()).then(function(){return y})})},m=new t(s||10),y=new e,w=u(r);!(p=w()).done;){var k=g(p.value,(new n).unlock(a));y.addInput(k)}o.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var b,O=u(o);!(b=O()).done;){var S=b.value;if(!S.inscription)throw new Error("Inscription is required for all destinations");y.addOutput({satoshis:1,lockingScript:(new d).lock(S.address,S.inscription.dataB64,S.inscription.contentType,l)})}for(var P,j=u(v);!(P=j()).done;){var A=P.value;y.addOutput({satoshis:A.amount,lockingScript:(new n).lock(A.to)})}y.addOutput({lockingScript:(new n).lock(c),change:!0});var I=null==f?void 0:f.idKey,_=null==f?void 0:f.keyHost,T=function(){if(!I)return function(){if(_){var n=null==f?void 0:f.authToken,r=new i(y);return function(t,e){try{var o=Promise.resolve(r.remoteSign(_,n)).then(function(n){y=n.signedTx})}catch(n){return e(n)}return o&&o.then?o.then(void 0,e):o}(0,function(n){throw console.log(n),new Error("Remote signing to "+_+" failed")})}}();var n=new i(y).sign(I);y=n.signedTx}();return Promise.resolve(T&&T.then?T.then(h):h())}catch(n){return Promise.reject(n)}},v=function(r,o,i,a,c,s,l,f,v){void 0===v&&(v=[]);try{for(var p,m=new t(l||h),y=new e,w=u(o);!(p=w()).done;){var k=g(p.value,(new d).unlock(c));y.addInput(k)}for(var b,O=u(r);!(b=O()).done;){var S=g(b.value,(new n).unlock(i));y.addInput(S)}if(s.length!==o.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var P,j=u(s);!(P=j()).done;){var A,I,_,T=P.value;_=null!=(A=T.inscription)&&A.dataB64&&null!=(I=T.inscription)&&I.contentType?(new d).lock(T.address,T.inscription.dataB64,T.inscription.contentType,f):(new n).lock(T.address),y.addOutput({satoshis:1,lockingScript:_})}for(var E,x=u(v);!(E=x()).done;){var B=E.value;y.addOutput({satoshis:B.amount,lockingScript:(new n).lock(B.to)})}var C=(new n).lock(a);return y.addOutput({lockingScript:C,change:!0}),Promise.resolve(y.fee(m)).then(function(){return Promise.resolve(y.sign()).then(function(){return y})})}catch(n){return Promise.reject(n)}},p=function(r,o,i,a,c){try{for(var s,l=new t(c||h),d=new e,f=u(r);!(s=f()).done;){var v=g(s.value,(new n).unlock(o));d.addInput(v)}var p={satoshis:a,lockingScript:(new n).lock(i)};d.addOutput(p);var m=o.toAddress().toString(),y=(new n).lock(m);return d.addOutput({lockingScript:y,change:!0}),Promise.resolve(d.fee(l)).then(function(){return Promise.resolve(d.sign()).then(function(){return d})})}catch(n){return Promise.reject(n)}},h=10,g=function(n,r){return o(c({},n,{script:Buffer.from(n.script,"base64").toString("hex")}),r)};export{f as createOrdinals,v as sendOrdinals,p as sendUtxos};
//# sourceMappingURL=index.module.js.map
