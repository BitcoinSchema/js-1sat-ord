import{P2PKH as r,LockingScript as n,fromUtxo as t,SatoshisPerKilobyte as e,Transaction as o}from"@bsv/sdk";import{Sigma as i}from"sigma-protocol";function a(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function u(r,n){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=function(r,n){if(r){if("string"==typeof r)return a(r,n);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){t&&(r=t);var e=0;return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(){return s=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)({}).hasOwnProperty.call(t,e)&&(r[e]=t[e])}return r},s.apply(null,arguments)}function c(r,n){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},c(r,n)}var l=function(r){return Buffer.from(r).toString("hex")},d=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}var o,i;return i=t,(o=e).prototype=Object.create(i.prototype),o.prototype.constructor=o,c(o,i),e.prototype.lock=function(t,e,o,i){var a="";if(void 0!==e&&void 0!==o){var u=l("ord"),s=Buffer.from(e,"base64").toString("hex").trim();if(!s)throw new Error("Invalid file data");var c=l(o);if(!c)throw new Error("Invalid media type");a="OP_0 OP_IF "+u+" OP_1 "+c+" OP_0 "+s+" OP_ENDIF"}var d=(a?a+" ":"")+(new r).lock(t).toASM();if(i&&(!i.app||!i.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=i&&i.app&&null!=i&&i.type){d=d+" OP_RETURN "+l("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+l("SET");for(var f=0,v=Object.entries(i);f<v.length;f++){var p=v[f],h=p[0],m=p[1];"cmd"!==h&&(d=d+" "+l(h)+" "+l(m))}}return n.fromASM(d)},e}(r),f=function(r,n){var e=t(s({},r,{script:Buffer.from(r.script,"base64").toString("hex")}),n);return e.sourceTXID=r.txid,e},v=function(r,n){try{var t,e=function(r){if(t)return r;throw new Error("Signer must be a LocalSigner or RemoteSigner")},o=null==n?void 0:n.idKey,a=null==n?void 0:n.keyHost;if(o){var u=new i(r).sign(o);return Promise.resolve(u.signedTx)}var s=function(){if(a){var e=null==n?void 0:n.authToken,o=new i(r);return function(r,n){try{var i=Promise.resolve(o.remoteSign(a,e)).then(function(r){return t=1,r.signedTx})}catch(r){return n(r)}return i&&i.then?i.then(void 0,n):i}(0,function(r){throw console.log(r),new Error("Remote signing to "+a+" failed")})}}();return Promise.resolve(s&&s.then?s.then(e):e(s))}catch(r){return Promise.reject(r)}},p=function(n,t,i,a,s,c,l,p){void 0===s&&(s=10),void 0===p&&(p=[]);try{for(var h,m=function(){return Promise.resolve(w.fee(g)).then(function(){return Promise.resolve(w.sign()).then(function(){return w})})},g=new e(s),w=new o,y=u(n);!(h=y()).done;){var P=f(h.value,(new r).unlock(i));w.addInput(P)}t.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var S,k=u(t);!(S=k()).done;){var b=S.value;if(!b.inscription)throw new Error("Inscription is required for all destinations");w.addOutput({satoshis:1,lockingScript:(new d).lock(b.address,b.inscription.dataB64,b.inscription.contentType,c)})}for(var O,A=u(p);!(O=A()).done;){var I=O.value;w.addOutput({satoshis:I.amount,lockingScript:(new r).lock(I.to)})}w.addOutput({lockingScript:(new r).lock(a||i.toAddress().toString()),change:!0});var j=function(){if(l)return Promise.resolve(v(w,l)).then(function(r){w=r})}();return Promise.resolve(j&&j.then?j.then(m):m())}catch(r){return Promise.reject(r)}},h=function(n,t,i,a,s,c,l,p,h,m,g){void 0===l&&(l=10),void 0===m&&(m=[]),void 0===g&&(g=!0);try{for(var w,y=function(){return Promise.resolve(S.fee(P)).then(function(){return Promise.resolve(S.sign()).then(function(){return S})})},P=new e(l),S=new o,k=u(t);!(w=k()).done;){var b=w.value;if(1!==b.satoshis)throw new Error("1Sat Ordinal utxos must have exactly 1 satoshi");var O=f(b,(new d).unlock(a));S.addInput(O)}for(var A,I=u(n);!(A=I()).done;){var j=f(A.value,(new r).unlock(i));S.addInput(j)}if(g&&s.length!==t.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var E,x=u(s);!(E=x()).done;){var T,_,M,B=E.value;M=null!=(T=B.inscription)&&T.dataB64&&null!=(_=B.inscription)&&_.contentType?(new d).lock(B.address,B.inscription.dataB64,B.inscription.contentType,p):(new r).lock(B.address),S.addOutput({satoshis:1,lockingScript:M})}for(var R,C=u(m);!(R=C()).done;){var K=R.value;console.log("Additional payment",K),S.addOutput({satoshis:K.amount,lockingScript:(new r).lock(K.to)})}var U=(new r).lock(c||i.toAddress().toString());S.addOutput({lockingScript:U,change:!0});var N=function(){if(h)return Promise.resolve(v(S,h)).then(function(r){S=r})}();return Promise.resolve(N&&N.then?N.then(y):y())}catch(r){return Promise.reject(r)}},m=function(n,t,i,a){void 0===a&&(a=10);try{for(var s,c=new e(a),l=new o,d=u(n);!(s=d()).done;){var v=f(s.value,(new r).unlock(t));l.addInput(v)}for(var p,h=u(i);!(p=h()).done;){var m=p.value,g={satoshis:m.amount,lockingScript:(new r).lock(m.to)};l.addOutput(g)}var w=t.toAddress().toString(),y=(new r).lock(w);return l.addOutput({lockingScript:y,change:!0}),Promise.resolve(l.fee(c)).then(function(){return Promise.resolve(l.sign()).then(function(){return l})})}catch(r){return Promise.reject(r)}};export{p as createOrdinals,h as sendOrdinals,m as sendUtxos};
//# sourceMappingURL=index.module.js.map
