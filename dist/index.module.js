import{P2PKH as r,LockingScript as n,SatoshisPerKilobyte as t,Transaction as e,fromUtxo as o}from"@bsv/sdk";import{Sigma as i}from"sigma-protocol";function a(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=Array(n);t<n;t++)e[t]=r[t];return e}function u(r,n){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=function(r,n){if(r){if("string"==typeof r)return a(r,n);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){t&&(r=t);var e=0;return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){return c=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)({}).hasOwnProperty.call(t,e)&&(r[e]=t[e])}return r},c.apply(null,arguments)}function s(r,n){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},s(r,n)}var l=function(r){for(var n=[],t=0,e=r.length;t<e;t++){var o=Number(r.charCodeAt(t)).toString(16);n.push(o)}return n.join("")},d=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}var o,i;return i=t,(o=e).prototype=Object.create(i.prototype),o.prototype.constructor=o,s(o,i),e.prototype.lock=function(t,e,o,i){var a="";if(void 0!==e&&void 0!==o){var u=l("ord"),c=Buffer.from(e,"base64").toString("hex").trim();if(!c)throw new Error("Invalid file data");var s=l(o);if(!s)throw new Error("Invalid media type");a="OP_0 OP_IF "+u+" OP_1 "+s+" OP_0 "+c+" OP_ENDIF"}var d=(a?a+" ":"")+(new r).lock(t).toASM();if(i&&(!i.app||!i.type))throw new Error("MAP.app and MAP.type are required fields");if(null!=i&&i.app&&null!=i&&i.type){d=d+" OP_RETURN "+l("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+l("SET");for(var f=0,p=Object.entries(i);f<p.length;f++){var v=p[f],h=v[0],g=v[1];"cmd"!==h&&(d=d+" "+l(h)+" "+l(g))}}return n.fromASM(d)},e}(r),f=function(n,o,a,c,s,l,f,p){void 0===p&&(p=[]);try{for(var v,h=function(r){return Promise.resolve(w.fee(m)).then(function(){return Promise.resolve(w.sign()).then(function(){return w})})},m=new t(s||10),w=new e,y=u(n);!(v=y()).done;){var k=g(v.value,(new r).unlock(a));w.addInput(k)}o.length>100&&console.warn("Creating many inscriptions at once can be slow. Consider using multiple transactions instead.");for(var b,O=u(o);!(b=O()).done;){var P=b.value;if(!P.inscription)throw new Error("Inscription is required for all destinations");w.addOutput({satoshis:1,lockingScript:(new d).lock(P.address,P.inscription.dataB64,P.inscription.contentType,l)})}for(var S,j=u(p);!(S=j()).done;){var A=S.value;w.addOutput({satoshis:A.amount,lockingScript:(new r).lock(A.to)})}w.addOutput({lockingScript:(new r).lock(c),change:!0});var I=null==f?void 0:f.idKey,E=null==f?void 0:f.keyHost,_=function(){if(!I)return function(){if(E){var r=null==f?void 0:f.authToken,n=new i(w);return function(t,e){try{var o=Promise.resolve(n.remoteSign(E,r)).then(function(r){w=r.signedTx})}catch(r){return e(r)}return o&&o.then?o.then(void 0,e):o}(0,function(r){throw console.log(r),new Error("Remote signing to "+E+" failed")})}}();var r=new i(w).sign(I);w=r.signedTx}();return Promise.resolve(_&&_.then?_.then(h):h())}catch(r){return Promise.reject(r)}},p=function(n,o,i,a,c,s,l,f,p){void 0===p&&(p=[]);try{for(var v,m=new t(l||h),w=new e,y=u(o);!(v=y()).done;){var k=g(v.value,(new d).unlock(c));w.addInput(k)}for(var b,O=u(n);!(b=O()).done;){var P=g(b.value,(new r).unlock(i));w.addInput(P)}if(s.length!==o.length)throw new Error("Number of destinations must match number of ordinals being sent");for(var S,j=u(s);!(S=j()).done;){var A,I,E,_=S.value;E=null!=(A=_.inscription)&&A.dataB64&&null!=(I=_.inscription)&&I.contentType?(new d).lock(_.address,_.inscription.dataB64,_.inscription.contentType,f):(new r).lock(_.address),w.addOutput({satoshis:1,lockingScript:E})}for(var T,M=u(p);!(T=M()).done;){var x=T.value;w.addOutput({satoshis:x.amount,lockingScript:(new r).lock(x.to)})}var B=(new r).lock(a);return w.addOutput({lockingScript:B,change:!0}),Promise.resolve(w.fee(m)).then(function(){return Promise.resolve(w.sign()).then(function(){return w})})}catch(r){return Promise.reject(r)}},v=function(n,o,i,a,c){try{for(var s,l=new t(c||h),d=new e,f=u(n);!(s=f()).done;){var p=g(s.value,(new r).unlock(o));d.addInput(p)}var v={satoshis:a,lockingScript:(new r).lock(i)};d.addOutput(v);var m=o.toAddress().toString(),w=(new r).lock(m);return d.addOutput({lockingScript:w,change:!0}),Promise.resolve(d.fee(l)).then(function(){return Promise.resolve(d.sign()).then(function(){return d})})}catch(r){return Promise.reject(r)}},h=10,g=function(r,n){return o(c({},r,{script:Buffer.from(r.script,"base64").toString("hex")}),n)};export{f as createOrdinals,p as sendOrdinals,v as sendUtxos};
//# sourceMappingURL=index.module.js.map
