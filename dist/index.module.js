import{P2PKH as e,LockingScript as t,UnlockingScript as r,Transaction as n}from"@bsv/sdk";import o from"fs";import s from"path";import c from"os";import a from"crypto";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const l="16.4.5",p=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function f(e){console.log(`[dotenv@${l}][DEBUG] ${e}`)}function v(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function d(e,t){let r;try{r=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const n=r.password;if(!n){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const o=r.searchParams.get("environment");if(!o){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const s=`DOTENV_VAULT_${o.toUpperCase()}`,c=e.parsed[s];if(!c){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${s} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:c,key:n}}function h(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const r of e.path)o.existsSync(r)&&(t=r.endsWith(".vault")?r:`${r}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=s.resolve(process.cwd(),".env.vault");return o.existsSync(t)?t:null}function g(e){return"~"===e[0]?s.join(c.homedir(),e.slice(1)):e}const m={configDotenv:function(e){const t=s.resolve(process.cwd(),".env");let r="utf8";const n=Boolean(e&&e.debug);e&&e.encoding?r=e.encoding:n&&f("No encoding is specified. UTF-8 is used by default");let c,a=[t];if(e&&e.path)if(Array.isArray(e.path)){a=[];for(const t of e.path)a.push(g(t))}else a=[g(e.path)];const i={};for(const t of a)try{const n=m.parse(o.readFileSync(t,{encoding:r}));m.populate(i,n,e)}catch(e){n&&f(`Failed to load ${t} ${e.message}`),c=e}let u=process.env;return e&&null!=e.processEnv&&(u=e.processEnv),m.populate(u,i,e),c?{parsed:i,error:c}:{parsed:i}},_configVault:function(e){console.log(`[dotenv@${l}][INFO] Loading env from encrypted .env.vault`);const t=m._parseVault(e);let r=process.env;return e&&null!=e.processEnv&&(r=e.processEnv),m.populate(r,t,e),{parsed:t}},_parseVault:function(e){const t=h(e),r=m.configDotenv({path:t});if(!r.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw e.code="MISSING_DATA",e}const n=v(e).split(","),o=n.length;let s;for(let e=0;e<o;e++)try{const t=d(r,n[e].trim());s=m.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=o)throw t}return m.parse(s)},config:function(e){if(0===v(e).length)return m.configDotenv(e);const t=h(e);return t?m._configVault(e):(console.log(`[dotenv@${l}][WARN] You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`),m.configDotenv(e))},decrypt:function(e,t){const r=Buffer.from(t.slice(-64),"hex");let n=Buffer.from(e,"base64");const o=n.subarray(0,12),s=n.subarray(-16);n=n.subarray(12,-16);try{const e=a.createDecipheriv("aes-256-gcm",r,o);return e.setAuthTag(s),`${e.update(n)}${e.final()}`}catch(e){const t=e instanceof RangeError,r="Unsupported state or unable to authenticate data"===e.message;if(t||"Invalid key length"===e.message){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const t={};let r,n=e.toString();for(n=n.replace(/\r\n?/gm,"\n");null!=(r=p.exec(n));){const e=r[1];let n=r[2]||"";n=n.trim();const o=n[0];n=n.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(n=n.replace(/\\n/g,"\n"),n=n.replace(/\\r/g,"\r")),t[e]=n}return t},populate:function(e,t,r={}){const n=Boolean(r&&r.debug),o=Boolean(r&&r.override);if("object"!=typeof t){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const r of Object.keys(t))Object.prototype.hasOwnProperty.call(e,r)?(!0===o&&(e[r]=t[r]),n&&f(!0===o?`"${r}" is already defined and WAS overwritten`:`"${r}" is already defined and was NOT overwritten`)):e[r]=t[r]}};var E=m._configVault,y=m._parseVault,_=m.config,D=m.decrypt,N=m.parse,T=m.populate,I=m;I.configDotenv=m.configDotenv,I._configVault=E,I._parseVault=y,I.config=_,I.decrypt=D,I.parse=N,I.populate=T;var O=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var o=Number(e.charCodeAt(r)).toString(16);t.push(o)}return t.join("")};_();var w=function(r,n,o,s){var c="";if(void 0!==n&&void 0!==o){var a=O("ord"),i=Buffer.from(n,"base64").toString("hex").trim();c="OP_0 OP_IF "+a+" OP_1 "+O(o)+" OP_0 "+(i?i+" ":"")+"OP_ENDIF"}var u=(new e).lock(r).toASM()+(c?" "+c:"");if(null!=s&&s.app&&null!=s&&s.type){u=u+" OP_RETURN "+O("1PuQa7K62MiKCtssSLKy1kh56WWU7MtUR5")+" "+O("SET");for(var l=0,p=Object.entries(s);l<p.length;l++){var f=p[l],v=f[0],d=f[1];"cmd"!==v&&(u=u+" "+O(v)+" "+O(d))}}return t.fromASM(u)},V=function(e,t,o,s){try{var c={sourceTXID:e.txid,sourceOutputIndex:e.vout,unlockingScript:r.fromASM(e.script),sequence:0},a=w(t,null==o?void 0:o.dataB64,null==o?void 0:o.contentType,s);return Promise.resolve(new n(1,[c],[{satoshis:1,lockingScript:a}],0))}catch(e){return Promise.reject(e)}},S=function(t,r,o,s,c,a,i,l,p){void 0===p&&(p=[]);try{var f=new e,v={sourceTXID:t.txid,sourceOutputIndex:t.vout,unlockingScriptTemplate:f.unlock(o),sequence:4294967295},d=w(r,a.dataB64,a.contentType,i),h=[];h.push({satoshis:1,lockingScript:d});for(var g,m=u(p);!(g=m()).done;){var E=g.value;h.push({satoshis:E.amount,lockingScript:(new e).lock(E.to)})}for(var y=0,_=h;y<_.length;y++);var D=(new e).lock(s);h.push({lockingScript:D,change:!0});var N=new n(1,[v],h,0);return Promise.resolve(N.fee()).then(function(){return N.getFee(),Promise.resolve(N.sign()).then(function(){return N})})}catch(e){return Promise.reject(e)}},k=function(t,o,s,c,a,i,l,p,f,v){void 0===v&&(v=[]);try{var d=[],h={sourceTXID:o.txid,sourceOutputIndex:o.vout,unlockingScript:r.fromASM(o.script),unlockingScriptTemplate:(new e).unlock(i),sequence:4294967295};d.push(h);var g,m={sourceTXID:t.txid,sourceOutputIndex:t.vout,unlockingScriptTemplate:(new e).unlock(s),sequence:4294967295};d.push(m),g=null!=p&&p.dataB64&&null!=p&&p.contentType?w(l,p.dataB64,p.contentType,f):(new e).lock(l);var E=[];E.push({satoshis:1,lockingScript:g});for(var y,_=u(v);!(y=_()).done;){var D=y.value;E.push({satoshis:D.amount,lockingScript:(new e).lock(D.to)})}var N=(new e).lock(c);E.push({satoshis:t.satoshis-1,lockingScript:N,change:!0});var T=new n(1,d,E,0);return Promise.resolve(T.fee()).then(function(){return Promise.resolve(T.sign()).then(function(){return T})})}catch(e){return Promise.reject(e)}},A=function(e,t,r,o){try{return Promise.resolve(new n(1,[],[],0))}catch(e){return Promise.reject(e)}},b=107,P=148,$=34;export{P as P2PKH_FULL_INPUT_SIZE,b as P2PKH_INPUT_SCRIPT_SIZE,$ as P2PKH_OUTPUT_SIZE,w as buildInscription,V as buildReinscriptionTemplate,S as createOrdinal,k as sendOrdinal,A as sendUtxos};
//# sourceMappingURL=index.module.js.map
